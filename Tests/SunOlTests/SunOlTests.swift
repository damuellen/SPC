import Utilities
import XCTest
import xlsxwriter

@testable import SunOl

class SunOlTests: XCTestCase {
  func testsCalculation() {
    let path = "/workspaces/SPC/input2.txt"
    guard let csv = CSV(atPath: path) else {
      print("No input.")
      return
    }
    TunOl.Q_Sol_MW_thLoop = [0] + csv["csp"]
    TunOl.Reference_PV_plant_power_at_inverter_inlet_DC = [0] + csv["pv"]
    TunOl.Reference_PV_MV_power_at_transformer_outlet = [0] + csv["out"]

    let model = TunOl([])
    let hour0 = model.hour0(
      TunOl.Q_Sol_MW_thLoop, TunOl.Reference_PV_plant_power_at_inverter_inlet_DC, TunOl.Reference_PV_MV_power_at_transformer_outlet)
    XCTAssertEqual(hour0[9105], 0.28, accuracy: 0.05, "H357")
    XCTAssertEqual(hour0[17865], 0.95, accuracy: 0.05, "I357")
    XCTAssertEqual(hour0[26625], 36.00, accuracy: 0.05, "J357")
    XCTAssertEqual(hour0[35385], 244.09, accuracy: 0.05, "K357")
    XCTAssertEqual(hour0[44145], 232.51, accuracy: 0.05, "L357")
    XCTAssertEqual(hour0[52905], 0.00, accuracy: 0.05, "M357")
    XCTAssertEqual(hour0[61665], 2.28, accuracy: 0.05, "O357")
    XCTAssertEqual(hour0[70425], 230.23, accuracy: 0.05, "P357")
    XCTAssertEqual(hour0[79185], 0.00, accuracy: 0.05, "Q357")
    XCTAssertEqual(hour0[87945], 116.52, accuracy: 0.05, "R357")
    XCTAssertEqual(hour0[96705], 116.52, accuracy: 0.05, "S357")
    XCTAssertEqual(hour0[105465], 49.21, accuracy: 0.05, "T357")
    XCTAssertEqual(hour0[114225], 14.0, accuracy: 1, "U357")
    XCTAssertEqual(hour0[122985], 100.36, accuracy: 0.05, "V357")
    XCTAssertEqual(hour0[131745], 0.00, accuracy: 0.05, "W357")
    XCTAssertEqual(hour0[140505], 0.00, accuracy: 0.05, "X357")
    XCTAssertEqual(hour0[149265], 50.00, accuracy: 0.05, "Y357")
    XCTAssertEqual(hour0[158025], 13.34, accuracy: 0.05, "Z357")
    XCTAssertEqual(hour0[166785], 86.66, accuracy: 0.05, "AA357")
    XCTAssertEqual(hour0[175545], 34.37, accuracy: 0.05, "AB357")
    XCTAssertEqual(hour0[184305], 11.26, accuracy: 0.05, "AC357")
    XCTAssertEqual(hour0[193065], 6.29, accuracy: 0.05, "AD357")
    XCTAssertEqual(hour0[201825], 65.00, accuracy: 0.05, "AE357")
    XCTAssertEqual(hour0[210585], 50.00, accuracy: 0.05, "AF357")
    XCTAssertEqual(hour0[219345], 205.66, accuracy: 0.05, "AG357")
    XCTAssertEqual(hour0[228105], 205.66, accuracy: 0.05, "AH357")
    XCTAssertEqual(hour0[236865], 87.36, accuracy: 0.05, "AI357")
    XCTAssertEqual(hour0[245625], 0.00, accuracy: 0.05, "AJ357")
    XCTAssertEqual(hour0[254385], 0.00, accuracy: 0.05, "AK357")
    XCTAssertEqual(hour0[263145], 27.31, accuracy: 0.05, "AL357")
    XCTAssertEqual(hour0[271905], 22.69, accuracy: 0.05, "AM357")
    XCTAssertEqual(hour0[280665], 51.88, accuracy: 0.05, "AN357")
    XCTAssertEqual(hour0[289425], 48.12, accuracy: 0.05, "AO357")
    XCTAssertEqual(hour0[298185], 21.56, accuracy: 0.05, "AP357")
    XCTAssertEqual(hour0[306945], 0.00, accuracy: 0.05, "AQ357")
    XCTAssertEqual(hour0[315705], 4.74, accuracy: 0.05, "AR357")
    XCTAssertEqual(hour0[324465], 0.00, accuracy: 0.05, "AS357")
    XCTAssertEqual(hour0[333225], 0.00, accuracy: 0.05, "AT357")
    let hour1 = model.hour1(hour0: hour0)

    XCTAssertEqual(hour1[345], 0.36, accuracy: 0.05, "AV357")
    XCTAssertEqual(hour1[9105], 232.15, accuracy: 0.05, "AW357")
    XCTAssertEqual(hour1[17865], 0.00, accuracy: 0.05, "AX357")
    XCTAssertEqual(hour1[26625], 0.00, accuracy: 0.05, "AY357")
    XCTAssertEqual(hour1[35385], 1739.03, accuracy: 0.05, "AZ357")
    XCTAssertEqual(hour1[44145], 0.00, accuracy: 0.05, "BA357")
    XCTAssertEqual(hour1[52905], 0.00, accuracy: 0.05, "BB357")
    XCTAssertEqual(hour1[61665], 0.00, accuracy: 0.05, "BC357")
    XCTAssertEqual(hour1[70425], 0.00, accuracy: 0.05, "BD357")
    XCTAssertEqual(hour1[79185], 0.00, accuracy: 0.05, "BE357")
    XCTAssertEqual(hour1[87945], 0.00, accuracy: 0.05, "BF357")
    XCTAssertEqual(hour1[96705], 0.00, accuracy: 0.05, "BG357")
    XCTAssertEqual(hour1[105465], 0.00, accuracy: 0.05, "BH357")
    XCTAssertEqual(hour1[114225], 232.15, accuracy: 0.05, "BI357")
    XCTAssertEqual(hour1[122985], 36.00, accuracy: 0.05, "BJ357")
    XCTAssertEqual(hour1[131745], 0.00, accuracy: 0.05, "BK357")
    XCTAssertEqual(hour1[140505], 116.52, accuracy: 0.05, "BL357")
    XCTAssertEqual(hour1[149265], 116.52, accuracy: 0.05, "BM357")
    XCTAssertEqual(hour1[158025], 49.21, accuracy: 0.05, "BN357")
    XCTAssertEqual(hour1[166785], 14.0, accuracy: 1, "BO357")
    XCTAssertEqual(hour1[175545], 102.29, accuracy: 0.05, "BP357")
    XCTAssertEqual(hour1[184305], 0.00, accuracy: 0.05, "BQ357")

    let day6 = model.day(hour0: hour0)
    var day = [[Double]]()
    let dayLVstart = 29200
    let dayMBend = 31390 + 365
    let dayNEstart = 41610
    let dayNKend = 43800 + 365

    let dayIPstart = 32120
    let dayIXend = 35040 + 365
    let dayJUstart = 43070
    let dayKCend = 45990 + 365

    for j in 0..<4 {
      let hour2 = model.hour2(j: j, hour0: hour0, hour1: hour1)
      if j == 0 {
        XCTAssertEqual(hour2[345], 0.00, accuracy: 0.05, "BU357")
        XCTAssertEqual(hour2[9105], 0.00, accuracy: 0.05, "BV357")
        XCTAssertEqual(hour2[17865], 0.00, accuracy: 0.05, "BW357")
        XCTAssertEqual(hour2[26625], 0.00, accuracy: 0.05, "BX357")
        XCTAssertEqual(hour2[35385], 0.00, accuracy: 0.05, "BY357")
        XCTAssertEqual(hour2[44145], 161.25, accuracy: 0.05, "BZ357")
        XCTAssertEqual(hour2[52905], 0.00, accuracy: 0.05, "CA357")
        XCTAssertEqual(hour2[61665], 0.00, accuracy: 0.05, "CB357")
        XCTAssertEqual(hour2[70425], 1414.47, accuracy: 0.05, "CC357")
        XCTAssertEqual(hour2[79185], 324.56, accuracy: 0.05, "CD357")
        XCTAssertEqual(hour2[87945], 0.00, accuracy: 0.05, "CE357")
        XCTAssertEqual(hour2[96705], 0.00, accuracy: 0.05, "CF357")
        XCTAssertEqual(hour2[105465], 0.00, accuracy: 0.05, "CG357")
        XCTAssertEqual(hour2[114225], 0.00, accuracy: 0.05, "CH357")
        XCTAssertEqual(hour2[122985], 0.00, accuracy: 0.05, "CI357")
        XCTAssertEqual(hour2[131745], 0.00, accuracy: 0.05, "CJ357")
        XCTAssertEqual(hour2[140505], 232.51, accuracy: 0.05, "CK357")
        XCTAssertEqual(hour2[149265], 36.00, accuracy: 0.05, "CL357")
        XCTAssertEqual(hour2[158025], 5.59, accuracy: 0.05, "CM357")
        XCTAssertEqual(hour2[166785], 0.00, accuracy: 0.05, "CN357")
      }
      let hour3 = model.hour3(j: j, hour0: hour0, hour1: hour1, hour2: hour2)
      if j == 0 {
        XCTAssertEqual(hour3[345], 116.52, accuracy: 0.05, "CP357")
        XCTAssertEqual(hour3[9105], 116.52, accuracy: 0.05, "CQ357")
        XCTAssertEqual(hour3[17865], 49.21, accuracy: 0.05, "CR357")
        XCTAssertEqual(hour3[35385], 0.00, accuracy: 0.05, "CT357")
        XCTAssertEqual(hour3[44145], 0.00, accuracy: 0.05, "CU357")
        XCTAssertEqual(hour3[52905], 97.06, accuracy: 0.05, "CV357")
        XCTAssertEqual(hour3[61665], 0.00, accuracy: 0.05, "CW357")
        XCTAssertEqual(hour3[70425], 0.00, accuracy: 0.05, "CX357")
        XCTAssertEqual(hour3[79185], 50.00, accuracy: 0.05, "CY357")
        XCTAssertEqual(hour3[87945], 13.34, accuracy: 0.05, "CZ357")
        XCTAssertEqual(hour3[96705], 86.66, accuracy: 0.05, "DA357")
        XCTAssertEqual(hour3[105465], 34.37, accuracy: 0.05, "DB357")
        XCTAssertEqual(hour3[114225], 11.26, accuracy: 0.05, "DC357")
        XCTAssertEqual(hour3[122985], 6.29, accuracy: 0.05, "DD357")
        XCTAssertEqual(hour3[131745], 65.00, accuracy: 0.05, "DE357")
        XCTAssertEqual(hour3[140505], 50.00, accuracy: 0.05, "DF357")
        XCTAssertEqual(hour3[149265], 205.66, accuracy: 0.05, "DG357")
        XCTAssertEqual(hour3[158025], 205.66, accuracy: 0.05, "DH357")
        XCTAssertEqual(hour3[166785], 87.36, accuracy: 0.05, "DI357")
        XCTAssertEqual(hour3[175545], 0.00, accuracy: 0.05, "DJ357")
        XCTAssertEqual(hour3[184305], 0.00, accuracy: 0.05, "DK357")
        XCTAssertEqual(hour3[193065], 30.62, accuracy: 0.05, "DL357")
        XCTAssertEqual(hour3[201825], 19.38, accuracy: 0.05, "DM357")
        XCTAssertEqual(hour3[210585], 51.88, accuracy: 0.05, "DN357")
        XCTAssertEqual(hour3[219325], 48.12, accuracy: 0.05, "DO357")
        XCTAssertEqual(hour3[228105], 21.56, accuracy: 0.05, "DP357")
        XCTAssertEqual(hour3[236865], 0.00, accuracy: 0.05, "DQ357")
        XCTAssertEqual(hour3[245625], 4.74, accuracy: 0.05, "DR357")
        XCTAssertEqual(hour3[254385], 0.00, accuracy: 0.05, "DS357")
        XCTAssertEqual(hour3[263145], 0.00, accuracy: 0.05, "DT357")
      }
      var day1 = model.day(case: j, hour2: hour2, hour3: hour3)
      if j == 0 {
        XCTAssertEqual(day1[330], 15.00, accuracy: 0.05, "C333")
        XCTAssertEqual(day1[695], 9.00, accuracy: 0.05, "D333")
        XCTAssertEqual(day1[1060], 14.00, accuracy: 0.05, "E333")
        XCTAssertEqual(day1[1425], 234.40, accuracy: 0.05, "F333")
        XCTAssertEqual(day1[1790], 468.80, accuracy: 0.05, "G333")
        XCTAssertEqual(day1[3615], 0.22, accuracy: 0.05, "L333")
        XCTAssertEqual(day1[3980], -0.56, accuracy: 0.05, "M333")
        XCTAssertEqual(day1[4345], 1.00, accuracy: 0.05, "N333")
        XCTAssertEqual(day1[4710], 1.00, accuracy: 0.05, "O333")
        XCTAssertEqual(day1[5075], 1.00, accuracy: 0.05, "P333")
        XCTAssertEqual(day1[5440], 1.00, accuracy: 0.05, "Q333")
        XCTAssertEqual(day1[5805], 0.70, accuracy: 0.05, "R333")
      }

      
      let hour4 = model.hour4(j: j, day1: day1, hour0: hour0, hour1: hour1, hour2: hour2)
      if j == 0 {
        XCTAssertEqual(hour4[9113], 0.00, accuracy: 0.05, "DW357")
        XCTAssertEqual(hour4[17873], 0.00, accuracy: 0.05, "DX357")
        XCTAssertEqual(hour4[26633], 2.57, accuracy: 0.05, "DY357")
        XCTAssertEqual(hour4[35393], 0.00, accuracy: 0.05, "DZ357")
        XCTAssertEqual(hour4[44153], 0.00, accuracy: 0.05, "EA357")
        XCTAssertEqual(hour4[52913], 161.25, accuracy: 0.05, "EB357")
        XCTAssertEqual(hour4[61673], 0.00, accuracy: 0.05, "EC357")
        XCTAssertEqual(hour4[70433], 0.00, accuracy: 0.05, "ED357")
        XCTAssertEqual(hour4[79193], 1406.73, accuracy: 0.05, "EE357")
        XCTAssertEqual(hour4[87953], 0.00, accuracy: 0.05, "EF357")
        XCTAssertEqual(hour4[96713], 0.00, accuracy: 0.05, "EG357")
        XCTAssertEqual(hour4[105473], 0.00, accuracy: 0.05, "EH357")
        XCTAssertEqual(hour4[9113], 0.00, accuracy: 0.05, "DW357")
        XCTAssertEqual(hour4[122993], 1406.73, accuracy: 0.05, "EJ357")
        XCTAssertEqual(hour4[131753], 332.30, accuracy: 0.05, "EK357")
        XCTAssertEqual(hour4[140513], 0.00, accuracy: 0.05, "EL357")
        XCTAssertEqual(hour4[149273], 0.00, accuracy: 0.05, "EM357")
        XCTAssertEqual(hour4[158033], 0.00, accuracy: 0.05, "EN357")
        XCTAssertEqual(hour4[166793], 0.00, accuracy: 0.05, "EO357")
        XCTAssertEqual(hour4[175553], 0.00, accuracy: 0.05, "EP357")
        XCTAssertEqual(hour4[184313], 0.00, accuracy: 0.05, "EQ357")
        XCTAssertEqual(hour4[193073], 232.51, accuracy: 0.05, "ER357")
        XCTAssertEqual(hour4[201833], 36.00, accuracy: 0.05, "ES357")
        XCTAssertEqual(hour4[210593], 5.59, accuracy: 0.05, "ET357")
        XCTAssertEqual(hour4[219353], 0.00, accuracy: 0.05, "EU357")
        XCTAssertEqual(hour4[228113], 116.52, accuracy: 0.05, "EW357")
        XCTAssertEqual(hour4[236873], 116.52, accuracy: 0.05, "EX357")
        XCTAssertEqual(hour4[245633], 49.21, accuracy: 0.05, "EY357")
        XCTAssertEqual(hour4[254393], 15.00, accuracy: 0.05, "EZ357")
        XCTAssertEqual(hour4[263153], 0.00, accuracy: 0.05, "FA357")
        XCTAssertEqual(hour4[271913], 0.00, accuracy: 0.05, "FB357")
        XCTAssertEqual(hour4[280673], 97.06, accuracy: 0.05, "FC357")
        XCTAssertEqual(hour4[289433], 0.00, accuracy: 0.05, "FD357")
        XCTAssertEqual(hour4[298193], 0.00, accuracy: 0.05, "FE357")
        XCTAssertEqual(hour4[306953], 50.00, accuracy: 0.05, "FF357")
        XCTAssertEqual(hour4[315713], 13.34, accuracy: 0.05, "FG357")
        XCTAssertEqual(hour4[324473], 86.66, accuracy: 0.05, "FH357")
        XCTAssertEqual(hour4[333233], 34.37, accuracy: 0.05, "FI357")
        XCTAssertEqual(hour4[341993], 11.26, accuracy: 0.05, "FJ357")
        XCTAssertEqual(hour4[350753], 6.29, accuracy: 0.05, "FK357")
        XCTAssertEqual(hour4[359513], 65.00, accuracy: 0.05, "FL357")
        XCTAssertEqual(hour4[368273], 50.00, accuracy: 0.05, "FM357")
        XCTAssertEqual(hour4[377033], 205.66, accuracy: 0.05, "FN357")
        XCTAssertEqual(hour4[385793], 205.66, accuracy: 0.05, "FO357")
        XCTAssertEqual(hour4[394553], 87.36, accuracy: 0.05, "FP357")
        XCTAssertEqual(hour4[403313], 0.00, accuracy: 0.05, "FQ357")
        XCTAssertEqual(hour4[412073], 0.00, accuracy: 0.05, "FR357")
        XCTAssertEqual(hour4[420833], 30.62, accuracy: 0.05, "FS357")
        XCTAssertEqual(hour4[429593], 19.38, accuracy: 0.05, "FT357")
        XCTAssertEqual(hour4[438353], 51.88, accuracy: 0.05, "FU357")
        XCTAssertEqual(hour4[447113], 48.12, accuracy: 0.05, "FV357")
        XCTAssertEqual(hour4[455873], 21.56, accuracy: 0.05, "FW357")
        XCTAssertEqual(hour4[464633], 0.00, accuracy: 0.05, "FX357")
        XCTAssertEqual(hour4[473393], 4.74, accuracy: 0.05, "FY357")
        XCTAssertEqual(hour4[482153], 0.00, accuracy: 0.05, "FZ357")
        XCTAssertEqual(hour4[490913], 0.00, accuracy: 0.05, "GA357")
      }
      model.night(case: j, day1: &day1, hour3: hour3, hour4: hour4)
      if j == 0 {
        XCTAssertEqual(day1[6170], 15.00, accuracy: 0.05, "T333")
        XCTAssertEqual(day1[6535], 9.00, accuracy: 0.05, "U333")
        XCTAssertEqual(day1[6900], 14.00, accuracy: 0.05, "V333")
        XCTAssertEqual(day1[7265], 468.80, accuracy: 0.05, "W333")
        XCTAssertEqual(day1[7630], 0.00, accuracy: 0.05, "X333")
        XCTAssertEqual(day1[7995], 0.00, accuracy: 0.05, "Y333")
        XCTAssertEqual(day1[8360], 1673.42, accuracy: 0.05, "Z333")
        XCTAssertEqual(day1[8725], 3291.09, accuracy: 0.05, "AA333")
        XCTAssertEqual(day1[9090], 497.36, accuracy: 0.05, "AB333")
        XCTAssertEqual(day1[9455], 985.02, accuracy: 0.05, "AC333")
        XCTAssertEqual(day1[9820], 234.40, accuracy: 0.05, "AD333")
        XCTAssertEqual(day1[10185], 468.80, accuracy: 0.05, "AE333")
        XCTAssertEqual(day1[10550], 206.06, accuracy: 0.05, "AF333")
        XCTAssertEqual(day1[10915], 412.12, accuracy: 0.05, "AG333")
        XCTAssertEqual(day1[11280], 28.34, accuracy: 0.05, "AH333")
        XCTAssertEqual(day1[11645], 56.68, accuracy: 0.05, "AI333")
        XCTAssertEqual(day1[12010], -0.56, accuracy: 0.05, "AJ333")
        XCTAssertEqual(day1[12375], 1.00, accuracy: 0.05, "AK333")
        XCTAssertEqual(day1[12740], 1.00, accuracy: 0.05, "AL333")
        XCTAssertEqual(day1[13105], 0.70, accuracy: 0.05, "AM333")
      }
      let day15 = model.day(hour0: hour0, hour2: hour2, hour3: hour3, day11: day1)
      let day16 = model.day(hour0: hour0, hour4: hour4, day11: day1, day15: day15)
      let day17 = model.day(case: j, day1: day1, day5: day15, day6: day16)

      day.append(Array(day17[dayLVstart..<dayMBend]))
      day.append(Array(day17[dayNEstart..<dayNKend]))

      let day21 = model.day(case: j, hour0: hour0)
      if j == 0 {
        XCTAssertEqual(day21[330], 136.32, accuracy: 0.05, "E333")
        XCTAssertEqual(day21[695], 149.51, accuracy: 0.05, "F333")
        XCTAssertEqual(day21[1060], 333.43, accuracy: 0.05, "G333")
        XCTAssertEqual(day21[1425], 543.74, accuracy: 0.05, "H333")
        XCTAssertEqual(day21[1790], 234.40, accuracy: 0.05, "I333")
        XCTAssertEqual(day21[2155], 468.80, accuracy: 0.05, "J333")
        XCTAssertEqual(day21[2520], 0.00, accuracy: 0.05, "K333")
        XCTAssertEqual(day21[2885], 0.00, accuracy: 0.05, "L333")
        XCTAssertEqual(day21[3250], 0.00, accuracy: 0.05, "M333")
        XCTAssertEqual(day21[3615], 0.00, accuracy: 0.05, "N333")
        XCTAssertEqual(day21[3980], 1673.42, accuracy: 0.05, "O333")
        XCTAssertEqual(day21[4345], 3291.09, accuracy: 0.05, "P333")
        XCTAssertEqual(day21[4710], 497.36, accuracy: 0.05, "Q333")
        XCTAssertEqual(day21[5075], 985.02, accuracy: 0.05, "R333")
        XCTAssertEqual(day21[5440], 234.40, accuracy: 0.05, "S333")
        XCTAssertEqual(day21[5805], 468.80, accuracy: 0.05, "T333")
        XCTAssertEqual(day21[6170], 206.06, accuracy: 0.05, "U333")
        XCTAssertEqual(day21[6535], 412.12, accuracy: 0.05, "V333")
        XCTAssertEqual(day21[6900], 28.34, accuracy: 0.05, "W333")
        XCTAssertEqual(day21[7265], 56.68, accuracy: 0.05, "X333")
        XCTAssertEqual(day21[7630], 0.22, accuracy: 0.05, "Y333")
        XCTAssertEqual(day21[7995], -0.56, accuracy: 0.05, "Z333")
        XCTAssertEqual(day21[8360], 1.00, accuracy: 0.05, "AA333")
        XCTAssertEqual(day21[8725], 1.00, accuracy: 0.05, "AB333")
        XCTAssertEqual(day21[9090], 1.00, accuracy: 0.05, "AC333")
        XCTAssertEqual(day21[9455], 1.00, accuracy: 0.05, "AD333")
        XCTAssertEqual(day21[9820], 0.70, accuracy: 0.05, "AE333")
      }
      if j == 1 {
        XCTAssertEqual(day21[330], 150.55, accuracy: 0.05, "AG333")
        XCTAssertEqual(day21[695], 180.55, accuracy: 0.05, "AH333")
        XCTAssertEqual(day21[1060], 189.31, accuracy: 0.05, "AI333")
        XCTAssertEqual(day21[1425], 334.84, accuracy: 0.05, "AJ333")
        XCTAssertEqual(day21[1790], 0.00, accuracy: 0.05, "AK333")
        XCTAssertEqual(day21[2155], 0.00, accuracy: 0.05, "AL333")
        XCTAssertEqual(day21[2520], 206.06, accuracy: 0.05, "AM333")
        XCTAssertEqual(day21[2885], 412.12, accuracy: 0.05, "AN333")
        XCTAssertEqual(day21[3250], 28.34, accuracy: 0.05, "AO333")
        XCTAssertEqual(day21[3615], 56.68, accuracy: 0.05, "AP333")
        XCTAssertEqual(day21[3980], 1656.63, accuracy: 0.05, "AQ333")
        XCTAssertEqual(day21[4345], 3257.50, accuracy: 0.05, "AR333")
        XCTAssertEqual(day21[4710], 562.14, accuracy: 0.05, "AS333")
        XCTAssertEqual(day21[5075], 1114.59, accuracy: 0.05, "AT333")
        XCTAssertEqual(day21[5440], 0.00, accuracy: 0.05, "AU333")
        XCTAssertEqual(day21[5805], 0.00, accuracy: 0.05, "AV333")
        XCTAssertEqual(day21[6170], 206.06, accuracy: 0.05, "AW333")
        XCTAssertEqual(day21[6535], 412.12, accuracy: 0.05, "AX333")
        XCTAssertEqual(day21[6900], 28.34, accuracy: 0.05, "AY333")
        XCTAssertEqual(day21[7265], 56.68, accuracy: 0.05, "AZ333")
        XCTAssertEqual(day21[7630], 1.00, accuracy: 0.05, "BA333")
        XCTAssertEqual(day21[7995], 1.00, accuracy: 0.05, "BB333")
        XCTAssertEqual(day21[8360], 0.96, accuracy: 0.05, "BC333")
        XCTAssertEqual(day21[8725], 0.92, accuracy: 0.05, "BD333")
        XCTAssertEqual(day21[9090], 0.53, accuracy: 0.05, "BE333")
        XCTAssertEqual(day21[9455], 0.06, accuracy: 0.05, "BF333")
        XCTAssertEqual(day21[9820], 1.10, accuracy: 0.05, "BG333")
      }
      if j == 2 {
        XCTAssertEqual(day21[330], 168.15, accuracy: 0.05, "BI333")
        XCTAssertEqual(day21[695], 208.10, accuracy: 0.05, "BJ333")
        XCTAssertEqual(day21[1060], 394.23, accuracy: 0.05, "BK333")
        XCTAssertEqual(day21[1425], 682.49, accuracy: 0.05, "BL333")
        XCTAssertEqual(day21[1790], 0.00, accuracy: 0.05, "BM333")
        XCTAssertEqual(day21[2155], 0.00, accuracy: 0.05, "BN333")
        XCTAssertEqual(day21[2520], 0.00, accuracy: 0.05, "BO333")
        XCTAssertEqual(day21[2885], 0.00, accuracy: 0.05, "BP333")
        XCTAssertEqual(day21[3250], 28.34, accuracy: 0.05, "BQ333")
        XCTAssertEqual(day21[3615], 51.58, accuracy: 0.05, "BR333")
        XCTAssertEqual(day21[3980], 1637.90, accuracy: 0.05, "BS333")
        XCTAssertEqual(day21[4345], 2935.05, accuracy: 0.05, "BT333")
        XCTAssertEqual(day21[4710], 356.09, accuracy: 0.05, "BU333")
        XCTAssertEqual(day21[5075], 640.08, accuracy: 0.05, "BV333")
        XCTAssertEqual(day21[5440], 0.00, accuracy: 0.05, "BW333")
        XCTAssertEqual(day21[5805], 0.00, accuracy: 0.05, "BX333")
        XCTAssertEqual(day21[6170], 0.00, accuracy: 0.05, "BY333")
        XCTAssertEqual(day21[6535], 0.00, accuracy: 0.05, "BZ333")
        XCTAssertEqual(day21[6900], 28.34, accuracy: 0.05, "CA333")
        XCTAssertEqual(day21[7265], 51.58, accuracy: 0.05, "CB333")
        XCTAssertEqual(day21[7630], 1.00, accuracy: 0.05, "CC333")
        XCTAssertEqual(day21[7995], 1.00, accuracy: 0.05, "CD333")
        XCTAssertEqual(day21[8360], 1.00, accuracy: 0.05, "CE333")
        XCTAssertEqual(day21[8725], 1.00, accuracy: 0.05, "CF333")
        XCTAssertEqual(day21[9090], 0.53, accuracy: 0.05, "CG333")
        XCTAssertEqual(day21[9455], 0.14, accuracy: 0.05, "CH333")
        XCTAssertEqual(day21[9820], 1.00, accuracy: 0.05, "CI333")
      }
      if j == 3 {
        XCTAssertEqual(day21[330], 1747.79, accuracy: 0.05, "CK333")
        XCTAssertEqual(day21[695], 3084.89, accuracy: 0.05, "CL333")
        XCTAssertEqual(day21[1060], 738.12, accuracy: 0.05, "CM333")
        XCTAssertEqual(day21[1425], 1310.37, accuracy: 0.05, "CN333")
        XCTAssertEqual(day21[1790], 0.00, accuracy: 0.05, "CO333")
        XCTAssertEqual(day21[2155], 0.00, accuracy: 0.05, "CP333")
        XCTAssertEqual(day21[2520], 0.00, accuracy: 0.05, "CQ333")
        XCTAssertEqual(day21[2885], 0.00, accuracy: 0.05, "CR333")
        XCTAssertEqual(day21[3250], 0.00, accuracy: 0.05, "CS333")
        XCTAssertEqual(day21[3615], 0.00, accuracy: 0.05, "CT333")
        XCTAssertEqual(day21[3980], 55.76, accuracy: 0.05, "CU333")
        XCTAssertEqual(day21[4345], 55.76, accuracy: 0.05, "CV333")
        XCTAssertEqual(day21[4710], 9.70, accuracy: 0.05, "CW333")
        XCTAssertEqual(day21[5075], 9.70, accuracy: 0.05, "CX333")
        XCTAssertEqual(day21[5440], 0.00, accuracy: 0.05, "CY333")
        XCTAssertEqual(day21[5805], 0.00, accuracy: 0.05, "CZ333")
        XCTAssertEqual(day21[6170], 0.00, accuracy: 0.05, "DA333")
        XCTAssertEqual(day21[6535], 0.00, accuracy: 0.05, "DB333")
        XCTAssertEqual(day21[6900], 0.00, accuracy: 0.05, "DC333")
        XCTAssertEqual(day21[7265], 0.00, accuracy: 0.05, "DD333")
        XCTAssertEqual(day21[7630], 1.00, accuracy: 0.05, "DE333")
        XCTAssertEqual(day21[7995], 1.00, accuracy: 0.05, "DF333")
        XCTAssertEqual(day21[8360], 1.00, accuracy: 0.05, "DG333")
        XCTAssertEqual(day21[8725], 1.00, accuracy: 0.05, "DH333")
        XCTAssertEqual(day21[9090], 1.00, accuracy: 0.05, "DI333")
        XCTAssertEqual(day21[9455], 1.00, accuracy: 0.05, "DJ333")
        XCTAssertEqual(day21[9820], 1.00, accuracy: 0.05, "DK333")
      }
      let day27 = model.day(case: j, day1: day21, day6: day6)

      day.append(Array(day27[dayIPstart..<dayIXend]))
      day.append(Array(day27[dayJUstart..<dayKCend]))
    }

    var year = [Int]()
    for d in 0..<365 {
      // let valuesDay = day.indices.map { i in day[i][d] }
      // let best = valuesDay.indices.filter { valuesDay[$0] > 0 }.sorted { valuesDay[$0] > valuesDay[$1] }
      // year.append(best[0])
    }

    let costs = Costs()
  }
}
