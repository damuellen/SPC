import Utilities
import XCTest
import xlsxwriter

@testable import SunOl

class SunOlTests: XCTestCase {
  func testsCalculation() {
    let path = "/workspaces/SPC/input2.txt"
    guard let csv = CSV(atPath: path) else {
      print("No input.")
      return
    }
    TunOl.Q_Sol_MW_thLoop = [0] + csv["csp"]
    TunOl.Reference_PV_plant_power_at_inverter_inlet_DC = [0] + csv["pv"]
    TunOl.Reference_PV_MV_power_at_transformer_outlet = [0] + csv["out"]

    let model = TunOl([])
    let hour0 = model.hour0(
      TunOl.Q_Sol_MW_thLoop, TunOl.Reference_PV_plant_power_at_inverter_inlet_DC, TunOl.Reference_PV_MV_power_at_transformer_outlet)
    print("Calculation")
    Array(hour0[..<61320]).head(6, steps: 8760)
    print("Calculation")
    Array(hour0[61320..<113880]).head(14, steps: 8760)
    print("Calculation")
    Array(hour0[113880...]).head(20, steps: 8760)
    XCTAssertEqual(hour0[9105], 0.28, accuracy: 0.05, "H349")
    XCTAssertEqual(hour0[17865], 0.95, accuracy: 0.05, "I349")
    XCTAssertEqual(hour0[26625], 36.00, accuracy: 0.05, "J349")
    XCTAssertEqual(hour0[35385], 244.09, accuracy: 0.05, "K349")
    XCTAssertEqual(hour0[44145], 232.51, accuracy: 0.05, "L349")
    XCTAssertEqual(hour0[52905], 0.00, accuracy: 0.05, "M349")
    XCTAssertEqual(hour0[61665], 2.28, accuracy: 0.05, "O349")
    XCTAssertEqual(hour0[70425], 230.23, accuracy: 0.05, "P349")
    XCTAssertEqual(hour0[79185], 0.00, accuracy: 0.05, "Q349")
    XCTAssertEqual(hour0[87945], 116.52, accuracy: 0.05, "R349")
    XCTAssertEqual(hour0[96705], 116.52, accuracy: 0.05, "S349")
    XCTAssertEqual(hour0[105465], 49.21, accuracy: 0.05, "T349")
    XCTAssertEqual(hour0[114225], 14.0, accuracy: 1, "U349")
    XCTAssertEqual(hour0[122985], 100.36, accuracy: 0.05, "V349")
    XCTAssertEqual(hour0[131745], 0.00, accuracy: 0.05, "W349")
    XCTAssertEqual(hour0[140505], 0.00, accuracy: 0.05, "X349")
    XCTAssertEqual(hour0[149265], 50.00, accuracy: 0.05, "Y349")
    XCTAssertEqual(hour0[158025], 13.34, accuracy: 0.05, "Z349")
    XCTAssertEqual(hour0[166785], 86.66, accuracy: 0.05, "AA349")
    XCTAssertEqual(hour0[175545], 34.37, accuracy: 0.05, "AB349")
    XCTAssertEqual(hour0[184305], 11.26, accuracy: 0.05, "AC349")
    XCTAssertEqual(hour0[193065], 6.29, accuracy: 0.05, "AD349")
    XCTAssertEqual(hour0[201825], 65.00, accuracy: 0.05, "AE349")
    XCTAssertEqual(hour0[210585], 50.00, accuracy: 0.05, "AF349")
    XCTAssertEqual(hour0[219345], 205.66, accuracy: 0.05, "AG349")
    XCTAssertEqual(hour0[228105], 205.66, accuracy: 0.05, "AH349")
    XCTAssertEqual(hour0[236865], 87.36, accuracy: 0.05, "AI349")
    XCTAssertEqual(hour0[245625], 0.00, accuracy: 0.05, "AJ349")
    XCTAssertEqual(hour0[254385], 0.00, accuracy: 0.05, "AK349")
    XCTAssertEqual(hour0[263145], 27.31, accuracy: 0.05, "AL349")
    XCTAssertEqual(hour0[271905], 22.69, accuracy: 0.05, "AM349")
    XCTAssertEqual(hour0[280665], 51.88, accuracy: 0.05, "AN349")
    XCTAssertEqual(hour0[289425], 48.12, accuracy: 0.05, "AO349")
    XCTAssertEqual(hour0[298185], 21.56, accuracy: 0.05, "AP349")
    XCTAssertEqual(hour0[306945], 0.00, accuracy: 0.05, "AQ349")
    XCTAssertEqual(hour0[315705], 4.74, accuracy: 0.05, "AR349")
    XCTAssertEqual(hour0[324465], 0.00, accuracy: 0.05, "AS349")
    XCTAssertEqual(hour0[333225], 0.00, accuracy: 0.05, "AT349")
    let hour1 = model.hour1(hour0: hour0)
    print("Calculation")
    hour1.head(47, steps: 8760)

    XCTAssertEqual(hour1[345], 0.36, accuracy: 0.05, "AV349")
    XCTAssertEqual(hour1[9105], 232.15, accuracy: 0.05, "AW349")
    XCTAssertEqual(hour1[17865], 0.00, accuracy: 0.05, "AX349")
    XCTAssertEqual(hour1[26625], 0.00, accuracy: 0.05, "AY349")
    XCTAssertEqual(hour1[35385], 1739.03, accuracy: 0.05, "AZ349")
    XCTAssertEqual(hour1[44145], 0.00, accuracy: 0.05, "BA349")
    XCTAssertEqual(hour1[52905], 0.00, accuracy: 0.05, "BB349")
    XCTAssertEqual(hour1[61665], 0.00, accuracy: 0.05, "BC349")
    XCTAssertEqual(hour1[70425], 0.00, accuracy: 0.05, "BD349")
    XCTAssertEqual(hour1[79185], 0.00, accuracy: 0.05, "BE349")
    XCTAssertEqual(hour1[87945], 0.00, accuracy: 0.05, "BF349")
    XCTAssertEqual(hour1[96705], 0.00, accuracy: 0.05, "BG349")
    XCTAssertEqual(hour1[105465], 0.00, accuracy: 0.05, "BH349")
    XCTAssertEqual(hour1[114225], 232.15, accuracy: 0.05, "BI349")
    XCTAssertEqual(hour1[122985], 36.00, accuracy: 0.05, "BJ349")
    XCTAssertEqual(hour1[131745], 0.00, accuracy: 0.05, "BK349")
    XCTAssertEqual(hour1[140505], 116.52, accuracy: 0.05, "BL349")
    XCTAssertEqual(hour1[149265], 116.52, accuracy: 0.05, "BM349")
    XCTAssertEqual(hour1[158025], 49.21, accuracy: 0.05, "BN349")
    XCTAssertEqual(hour1[166785], 14.0, accuracy: 1, "BO349")
    XCTAssertEqual(hour1[175545], 102.29, accuracy: 0.05, "BP349")
    XCTAssertEqual(hour1[184305], 0.00, accuracy: 0.05, "BQ349")

    let day6 = model.day(hour0: hour0)
    print("Daily 2")
    Array(day6[0..<5840]).head(121, steps: 365)
    print("Daily 2")
    Array(day6[5840...]).head(137, steps: 365)
    var day = [[Double]]()
    let day11start = 29200
    let day11end = 31390
    let day12start = 41610
    let day12end = 43800

    let day21start = 33945
    let day21end = 35040
    let day22start = 44895
    let day22end = 45990

    for j in 0..<4 {      
      let hour2 = model.hour2(j: j, hour0: hour0, hour1: hour1)
      if j == 0 { print("Hour Case", j); hour2.head(72, steps: 8760) }
      if j == 1 { print("Hour Case", j); hour2.head(184, steps: 8760) }
      if j == 2 { print("Hour Case", j); hour2.head(296, steps: 8760) }
      if j == 0 {
        XCTAssertEqual(hour2[345], 0.00, accuracy: 0.05, "BU349")
        XCTAssertEqual(hour2[9105], 0.00, accuracy: 0.05, "BV349")
        XCTAssertEqual(hour2[17865], 0.00, accuracy: 0.05, "BW349")
        XCTAssertEqual(hour2[26625], 0.00, accuracy: 0.05, "BX349")
        XCTAssertEqual(hour2[35385], 0.00, accuracy: 0.05, "BY349")
        XCTAssertEqual(hour2[44145], 161.25, accuracy: 0.05, "BZ349")
        XCTAssertEqual(hour2[52905], 0.00, accuracy: 0.05, "CA349")
        XCTAssertEqual(hour2[61665], 0.00, accuracy: 0.05, "CB349")
        XCTAssertEqual(hour2[70425], 1414.47, accuracy: 0.05, "CC349")
        XCTAssertEqual(hour2[79185], 324.56, accuracy: 0.05, "CD349")
        XCTAssertEqual(hour2[87945], 0.00, accuracy: 0.05, "CE349")
        XCTAssertEqual(hour2[96705], 0.00, accuracy: 0.05, "CF349")
        XCTAssertEqual(hour2[105465], 0.00, accuracy: 0.05, "CG349")
        XCTAssertEqual(hour2[114225], 0.00, accuracy: 0.05, "CH349")
        XCTAssertEqual(hour2[122985], 0.00, accuracy: 0.05, "CI349")
        XCTAssertEqual(hour2[131745], 0.00, accuracy: 0.05, "CJ349")
        XCTAssertEqual(hour2[140505], 232.51, accuracy: 0.05, "CK349")
        XCTAssertEqual(hour2[149265], 36.00, accuracy: 0.05, "CL349")
        XCTAssertEqual(hour2[158025], 5.59, accuracy: 0.05, "CM349")
        XCTAssertEqual(hour2[166785], 0.00, accuracy: 0.05, "CN349")
      }
      print("Hour Case", j)
      let hour3 = model.hour3(j: j, hour0: hour0, hour1: hour1, hour2: hour2)
      hour3.head(93, steps: 8760)
      if j == 0 {
        XCTAssertEqual(hour3[345], 116.52, accuracy: 0.05, "CP349")
        XCTAssertEqual(hour3[9105], 116.52, accuracy: 0.05, "CQ349")
        XCTAssertEqual(hour3[17865], 49.21, accuracy: 0.05, "CR349")
        XCTAssertEqual(hour3[35385], 0.00, accuracy: 0.05, "CT349")
        XCTAssertEqual(hour3[44145], 0.00, accuracy: 0.05, "CU349")
        XCTAssertEqual(hour3[52905], 97.06, accuracy: 0.05, "CV349")
        XCTAssertEqual(hour3[61665], 0.00, accuracy: 0.05, "CW349")
        XCTAssertEqual(hour3[70425], 0.00, accuracy: 0.05, "CX349")
        XCTAssertEqual(hour3[79185], 50.00, accuracy: 0.05, "CY349")
        XCTAssertEqual(hour3[87945], 13.34, accuracy: 0.05, "CZ349")
        XCTAssertEqual(hour3[96705], 86.66, accuracy: 0.05, "DA349")
        XCTAssertEqual(hour3[105465], 34.37, accuracy: 0.05, "DB349")
        XCTAssertEqual(hour3[114225], 11.26, accuracy: 0.05, "DC349")
        XCTAssertEqual(hour3[122985], 6.29, accuracy: 0.05, "DD349")
        XCTAssertEqual(hour3[131745], 65.00, accuracy: 0.05, "DE349")
        XCTAssertEqual(hour3[140505], 50.00, accuracy: 0.05, "DF349")
        XCTAssertEqual(hour3[149265], 205.66, accuracy: 0.05, "DG349")
        XCTAssertEqual(hour3[158025], 205.66, accuracy: 0.05, "DH349")
        XCTAssertEqual(hour3[166785], 87.36, accuracy: 0.05, "DI349")
        XCTAssertEqual(hour3[175545], 0.00, accuracy: 0.05, "DJ349")
        XCTAssertEqual(hour3[184305], 0.00, accuracy: 0.05, "DK349")
        XCTAssertEqual(hour3[193065], 30.62, accuracy: 0.05, "DL349")
        XCTAssertEqual(hour3[201825], 19.38, accuracy: 0.05, "DM349")
        XCTAssertEqual(hour3[210585], 51.88, accuracy: 0.05, "DN349")
        XCTAssertEqual(hour3[219345], 48.12, accuracy: 0.05, "DO349")
        XCTAssertEqual(hour3[228105], 21.56, accuracy: 0.05, "DP349")
        XCTAssertEqual(hour3[236865], 0.00, accuracy: 0.05, "DQ349")
        XCTAssertEqual(hour3[245625], 4.74, accuracy: 0.05, "DR349")
        XCTAssertEqual(hour3[254385], 0.00, accuracy: 0.05, "DS349")
        XCTAssertEqual(hour3[263145], 0.00, accuracy: 0.05, "DT349")
      }

      var day1 = model.day(case: j, hour2: hour2, hour3: hour3)

      if j == 0 {
        XCTAssertEqual(day1[331], 15.00, accuracy: 0.05, "C333")
        XCTAssertEqual(day1[696], 9.00, accuracy: 0.05, "D333")
        XCTAssertEqual(day1[1061], 14.00, accuracy: 0.05, "E333")
        XCTAssertEqual(day1[1426], 234.40, accuracy: 0.05, "F333")
        XCTAssertEqual(day1[1791], 468.80, accuracy: 0.05, "G333")
        XCTAssertEqual(day1[3616], 0.22, accuracy: 0.05, "L333")
        XCTAssertEqual(day1[3981], -0.56, accuracy: 0.05, "M333")
        XCTAssertEqual(day1[4346], 1.00, accuracy: 0.05, "N333")
        XCTAssertEqual(day1[4711], 1.00, accuracy: 0.05, "O333")
        XCTAssertEqual(day1[5076], 1.00, accuracy: 0.05, "P333")
        XCTAssertEqual(day1[5441], 1.00, accuracy: 0.05, "Q333")
        XCTAssertEqual(day1[5806], 0.70, accuracy: 0.05, "R333")
      }
      print("Hour Case", j)
      let hour4 = model.hour4(j: j, day1: day1, hour0: hour0, hour1: hour1, hour2: hour2)

      Array(hour4[0..<227760]).head(125, steps: 8760)
      Array(hour4[227760...]).head(152, steps: 8760)
      if j == 0 {
      XCTAssertEqual(hour4[8769], 0.00, accuracy: 0.1, "DW13")
      XCTAssertEqual(hour4[52569], 161.25, accuracy: 0.1, "EB13")
      XCTAssertEqual(hour4[8770], 8.81, accuracy: 0.1, "DW14")
      XCTAssertEqual(hour4[17530], 8.81, accuracy: 0.1, "DX14")
      XCTAssertEqual(hour4[35050], 20.50, accuracy: 0.1, "DZ14")
      XCTAssertEqual(hour4[43810], 23.75, accuracy: 0.1, "EA14")
      XCTAssertEqual(hour4[61330], 69.53, accuracy: 0.1, "EC14")
      }

      model.night(case: j, day1: &day1, hour3: hour3, hour4: hour4)
      print("Daily Case", j)
      Array(day1[0..<5840]).head(2, steps: 365)
      print("Daily Case", j)
      Array(day1[5840...]).head(19, steps: 365)
      if j == 0 {
        XCTAssertEqual(day1[6170], 15.00, accuracy: 0.05, "T333")
        XCTAssertEqual(day1[6535], 9.00, accuracy: 0.05, "U333")
        XCTAssertEqual(day1[6900], 14.00, accuracy: 0.05, "V333")
        XCTAssertEqual(day1[7265], 468.80, accuracy: 0.05, "W333")
        XCTAssertEqual(day1[7630], 0.00, accuracy: 0.05, "X333")
        XCTAssertEqual(day1[7995], 0.00, accuracy: 0.05, "Y333")
        XCTAssertEqual(day1[8360], 1673.42, accuracy: 0.05, "Z333")
        XCTAssertEqual(day1[8725], 3291.09, accuracy: 0.05, "AA333")
        XCTAssertEqual(day1[9090], 497.36, accuracy: 0.05, "AB333")
        XCTAssertEqual(day1[9455], 985.02, accuracy: 0.05, "AC333")
        XCTAssertEqual(day1[9820], 234.40, accuracy: 0.05, "AD333")
        XCTAssertEqual(day1[10185], 468.80, accuracy: 0.05, "AE333")
        XCTAssertEqual(day1[10550], 206.06, accuracy: 0.05, "AF333")
        XCTAssertEqual(day1[10915], 412.12, accuracy: 0.05, "AG333")
        XCTAssertEqual(day1[11280], 28.34, accuracy: 0.05, "AH333")
        XCTAssertEqual(day1[11645], 56.68, accuracy: 0.05, "AI333")
        XCTAssertEqual(day1[12010], -0.56, accuracy: 0.05, "AJ333")
        XCTAssertEqual(day1[12375], 1.00, accuracy: 0.05, "AK333")
        XCTAssertEqual(day1[12740], 1.00, accuracy: 0.05, "AL333")
        XCTAssertEqual(day1[13105], 0.70, accuracy: 0.05, "AM333")
      }

      let day15 = model.day(hour0: hour0, hour2: hour2, hour3: hour3, day11: day1)
      if j == 0 {
        print("Daily Case", j)
        Array(day15[0..<9125]).head(154, steps: 365)
        print("Daily Case", j)
        Array(day15[9125...]).head(179, steps: 365)
      }
      if j == 1 {
        print("Daily Case", j)
        Array(day15[0..<9125]).head(376, steps: 365)
        print("Daily Case", j)
        Array(day15[9125...]).head(401, steps: 365)
      }
      if j == 0 {
        XCTAssertEqual(day15[330], 2992.33, accuracy: 0.1, "EY333")
        XCTAssertEqual(day15[695], 139.83, accuracy: 0.1, "EZ333")
        XCTAssertEqual(day15[1060], 171.60, accuracy: 0.1, "FA333")
        XCTAssertEqual(day15[1425], 0.00, accuracy: 0.1, "FB333")
        XCTAssertEqual(day15[1790], 932.15, accuracy: 0.1, "FC333")
        XCTAssertEqual(day15[2155], 1645.28, accuracy: 0.1, "FD333")
        XCTAssertEqual(day15[2520], 0.00, accuracy: 0.1, "FE333")
        XCTAssertEqual(day15[2885], 393.67, accuracy: 0.1, "FF333")
        XCTAssertEqual(day15[3250], 698.87, accuracy: 0.1, "FG333")
        XCTAssertEqual(day15[3615], 0.00, accuracy: 0.1, "FH333")
        XCTAssertEqual(day15[3980], 0.00, accuracy: 0.1, "FI333")
        XCTAssertEqual(day15[4345], 80.13, accuracy: 0.1, "FJ333")
        XCTAssertEqual(day15[4710], 0.00, accuracy: 0.1, "FK333")
        XCTAssertEqual(day15[5075], 286.11, accuracy: 0.1, "FL333")
        XCTAssertEqual(day15[5440], 537.69, accuracy: 0.1, "FM333")
        XCTAssertEqual(day15[5805], 0.00, accuracy: 0.1, "FN333")
        XCTAssertEqual(day15[6170], 18.88, accuracy: 0.1, "FO333")
        XCTAssertEqual(day15[6535], 50.46, accuracy: 0.1, "FP333")
        XCTAssertEqual(day15[6900], 0.00, accuracy: 0.1, "FQ333")
        XCTAssertEqual(day15[7265], 45.90, accuracy: 0.1, "FR333")
        XCTAssertEqual(day15[7630], 1755.18, accuracy: 0.1, "FS333")
        XCTAssertEqual(day15[7995], 870.61, accuracy: 0.1, "FT333")
        XCTAssertEqual(day15[8360], 135.27, accuracy: 0.1, "FU333")
        XCTAssertEqual(day15[8725], 61.18, accuracy: 0.1, "FV333")
        XCTAssertEqual(day15[9090], 5.04, accuracy: 0.1, "FW333")
        XCTAssertEqual(day15[9455], 0.00, accuracy: 0.1, "FX333")
        XCTAssertEqual(day15[9820], 185.71, accuracy: 0.1, "FY333")
        XCTAssertEqual(day15[10185], 185.71, accuracy: 0.1, "FZ333")
        XCTAssertEqual(day15[10550], 89.87, accuracy: 0.1, "GA333")
        XCTAssertEqual(day15[10915], 400.00, accuracy: 0.1, "GB333")
        XCTAssertEqual(day15[11280], 276.90, accuracy: 0.1, "GC333")
        XCTAssertEqual(day15[11645], 74.87, accuracy: 0.1, "GD333")
        XCTAssertEqual(day15[12010], 400.00, accuracy: 0.1, "GE333")
        XCTAssertEqual(day15[12375], 331.38, accuracy: 0.1, "GF333")
        XCTAssertEqual(day15[12740], 800.00, accuracy: 0.1, "GG333")
        XCTAssertEqual(day15[13105], 513.89, accuracy: 0.1, "GH333")
        XCTAssertEqual(day15[13470], 262.31, accuracy: 0.1, "GI333")
        XCTAssertEqual(day15[13835], 1600.00, accuracy: 0.1, "GJ333")
        XCTAssertEqual(day15[14200], 274.99, accuracy: 0.1, "GK333")
        XCTAssertEqual(day15[14565], 172.49, accuracy: 0.1, "GL333")
        XCTAssertEqual(day15[14930], 800.00, accuracy: 0.1, "GM333")
        XCTAssertEqual(day15[15295], 90.10, accuracy: 0.1, "GN333")
        XCTAssertEqual(day15[15660], 0.00, accuracy: 0.1, "GO333")
        XCTAssertEqual(day15[16025], 400.00, accuracy: 0.1, "GP333")
        XCTAssertEqual(day15[16390], 50.34, accuracy: 0.1, "GQ333")
        XCTAssertEqual(day15[16755], 37.95, accuracy: 0.1, "GR333")
        XCTAssertEqual(day15[17120], 130.91, accuracy: 0.1, "GS333")

        XCTAssertEqual(day15[331], 4371.09, accuracy: 0.1, "EY334")
        XCTAssertEqual(day15[696], 310.75, accuracy: 0.1, "EZ334")
        XCTAssertEqual(day15[1061], 756.30, accuracy: 0.1, "FA334")
        XCTAssertEqual(day15[1426], 201.23, accuracy: 0.1, "FB334")
        XCTAssertEqual(day15[1791], 1048.67, accuracy: 0.1, "FC334")
        XCTAssertEqual(day15[2156], 1841.43, accuracy: 0.1, "FD334")
        XCTAssertEqual(day15[2521], 136.32, accuracy: 0.1, "FE334")
        XCTAssertEqual(day15[2886], 442.87, accuracy: 0.1, "FF334")
        XCTAssertEqual(day15[3251], 782.16, accuracy: 0.1, "FG334")
        XCTAssertEqual(day15[3616], 333.43, accuracy: 0.1, "FH334")
        XCTAssertEqual(day15[3981], 0.00, accuracy: 0.1, "FI334")
        XCTAssertEqual(day15[4346], 63.34, accuracy: 0.1, "FJ334")
        XCTAssertEqual(day15[4711], 0.00, accuracy: 0.1, "FK334")
        XCTAssertEqual(day15[5076], 13.34, accuracy: 0.1, "FL334")
        XCTAssertEqual(day15[5441], 126.97, accuracy: 0.1, "FM334")
        XCTAssertEqual(day15[5806], 133.53, accuracy: 0.1, "FN334")
        XCTAssertEqual(day15[6171], 47.24, accuracy: 0.1, "FO334")
        XCTAssertEqual(day15[6536], 32.73, accuracy: 0.1, "FP334")
        XCTAssertEqual(day15[6901], 0.00, accuracy: 0.1, "FQ334")
        XCTAssertEqual(day15[7266], 0.00, accuracy: 0.1, "FR334")
        XCTAssertEqual(day15[7631], 3261.83, accuracy: 0.1, "FS334")
        XCTAssertEqual(day15[7996], 2418.79, accuracy: 0.1, "FT334")
        XCTAssertEqual(day15[8361], 8.17, accuracy: 0.1, "FU334")
        XCTAssertEqual(day15[8726], 326.63, accuracy: 0.1, "FV334")
        XCTAssertEqual(day15[9091], 99.84, accuracy: 0.1, "FW334")
        XCTAssertEqual(day15[9456], 0.00, accuracy: 0.1, "FX334")
        XCTAssertEqual(day15[9821], 185.71, accuracy: 0.1, "FY334")
        XCTAssertEqual(day15[10186], 185.71, accuracy: 0.1, "FZ334")
        XCTAssertEqual(day15[10551], 8.17, accuracy: 0.1, "GA334")
        XCTAssertEqual(day15[10916], 450.00, accuracy: 0.1, "GB334")
        XCTAssertEqual(day15[11281], 400.00, accuracy: 0.1, "GC334")
        XCTAssertEqual(day15[11646], 8.17, accuracy: 0.1, "GD334")
        XCTAssertEqual(day15[12011], 450.00, accuracy: 0.1, "GE334")
        XCTAssertEqual(day15[12376], 400.00, accuracy: 0.1, "GF334")
        XCTAssertEqual(day15[12741], 750.00, accuracy: 0.1, "GG334")
        XCTAssertEqual(day15[13106], 886.66, accuracy: 0.1, "GH334")
        XCTAssertEqual(day15[13471], 773.03, accuracy: 0.1, "GI334")
        XCTAssertEqual(day15[13836], 1366.47, accuracy: 0.1, "GJ334")
        XCTAssertEqual(day15[14201], 309.36, accuracy: 0.1, "GK334")
        XCTAssertEqual(day15[14566], 195.42, accuracy: 0.1, "GL334")
        XCTAssertEqual(day15[14931], 750.00, accuracy: 0.1, "GM334")
        XCTAssertEqual(day15[15296], 101.37, accuracy: 0.1, "GN334")
        XCTAssertEqual(day15[15661], 1.20, accuracy: 0.1, "GO334")
        XCTAssertEqual(day15[16026], 375.00, accuracy: 0.1, "GP334")
        XCTAssertEqual(day15[16391], 56.63, accuracy: 0.1, "GQ334")
        XCTAssertEqual(day15[16756], 42.86, accuracy: 0.1, "GR334")
        XCTAssertEqual(day15[17121], 122.73, accuracy: 0.1, "GS334")
      }      
      let day16 = model.day(hour0: hour0, hour4: hour4, day11: day1, day15: day15)
      print("Daily 1 Case", j)
      Array(day16[..<9125]).head(202, steps: 365)
      print("Daily 1 Case", j)
      Array(day16[9125...]).head(227, steps: 365)
      if j == 0 {
        XCTAssertEqual(day16[330], 2992.33, accuracy: 0.1, "GU333")
        XCTAssertEqual(day16[695], 139.83, accuracy: 0.1, "GV333")
        XCTAssertEqual(day16[1060], 171.60, accuracy: 0.1, "GW333")
        XCTAssertEqual(day16[1425], 0.00, accuracy: 0.1, "GX333")
        XCTAssertEqual(day16[1790], 932.15, accuracy: 0.1, "GY333")
        XCTAssertEqual(day16[2155], 1645.28, accuracy: 0.1, "GZ333")
        XCTAssertEqual(day16[2520], 0.00, accuracy: 0.1, "HA333")
        XCTAssertEqual(day16[2885], 393.67, accuracy: 0.1, "HB333")
        XCTAssertEqual(day16[3250], 698.87, accuracy: 0.1, "HC333")
        XCTAssertEqual(day16[3615], 0.00, accuracy: 0.1, "HD333")
        XCTAssertEqual(day16[3980], 0.00, accuracy: 0.1, "HE333")
        XCTAssertEqual(day16[4345], 80.13, accuracy: 0.1, "HF333")
        XCTAssertEqual(day16[4710], 0.00, accuracy: 0.1, "HG333")
        XCTAssertEqual(day16[5075], 286.11, accuracy: 0.1, "HH333")
        XCTAssertEqual(day16[5440], 537.69, accuracy: 0.1, "HI333")
        XCTAssertEqual(day16[5805], 0.00, accuracy: 0.1, "HJ333")
        XCTAssertEqual(day16[6170], 18.88, accuracy: 0.1, "HK333")
        XCTAssertEqual(day16[6535], 50.46, accuracy: 0.1, "HL333")
        XCTAssertEqual(day16[6900], 0.00, accuracy: 0.1, "HM333")
        XCTAssertEqual(day16[7265], 45.90, accuracy: 0.1, "HN333")
        XCTAssertEqual(day16[7630], 1755.18, accuracy: 0.1, "HO333")
        XCTAssertEqual(day16[7995], 870.61, accuracy: 0.1, "HP333")
        XCTAssertEqual(day16[8360], 135.27, accuracy: 0.1, "HQ333")
        XCTAssertEqual(day16[8725], 61.18, accuracy: 0.1, "HR333")
        XCTAssertEqual(day16[9090], 5.04, accuracy: 0.1, "HS333")
        XCTAssertEqual(day16[9455], 0.00, accuracy: 0.1, "HT333")
        XCTAssertEqual(day16[9820], 185.71, accuracy: 0.1, "HU333")
        XCTAssertEqual(day16[10185], 185.71, accuracy: 0.1, "HV333")
        XCTAssertEqual(day16[10550], 89.87, accuracy: 0.1, "HW333")
        XCTAssertEqual(day16[10915], 400.00, accuracy: 0.1, "HX333")
        XCTAssertEqual(day16[11280], 276.90, accuracy: 0.1, "HY333")
        XCTAssertEqual(day16[11645], 74.87, accuracy: 0.1, "HZ333")
        XCTAssertEqual(day16[12010], 400.00, accuracy: 0.1, "IA333")
        XCTAssertEqual(day16[12375], 331.38, accuracy: 0.1, "IB333")
        XCTAssertEqual(day16[12740], 800.00, accuracy: 0.1, "IC333")
        XCTAssertEqual(day16[13105], 513.89, accuracy: 0.1, "ID333")
        XCTAssertEqual(day16[13470], 262.31, accuracy: 0.1, "IE333")
        XCTAssertEqual(day16[13835], 1600.00, accuracy: 0.1, "IF333")
        XCTAssertEqual(day16[14200], 274.99, accuracy: 0.1, "IG333")
        XCTAssertEqual(day16[14565], 172.49, accuracy: 0.1, "IH333")
        XCTAssertEqual(day16[14930], 800.00, accuracy: 0.1, "II333")
        XCTAssertEqual(day16[15295], 90.10, accuracy: 0.1, "IJ333")
        XCTAssertEqual(day16[15660], 0.00, accuracy: 0.1, "IK333")
        XCTAssertEqual(day16[16025], 400.00, accuracy: 0.1, "IL333")
        XCTAssertEqual(day16[16390], 50.34, accuracy: 0.1, "IM333")
        XCTAssertEqual(day16[16755], 37.95, accuracy: 0.1, "IN333")
        XCTAssertEqual(day16[17120], 130.91, accuracy: 0.1, "IO333")

        XCTAssertEqual(day16[331], 4369.61, accuracy: 0.1, "GU334")
        XCTAssertEqual(day16[696], 310.54, accuracy: 0.1, "GV334")
        XCTAssertEqual(day16[1061], 755.21, accuracy: 0.1, "GW334")
        XCTAssertEqual(day16[1426], 203.78, accuracy: 0.1, "GX334")
        XCTAssertEqual(day16[1791], 1048.67, accuracy: 0.1, "GY334")
        XCTAssertEqual(day16[2156], 1841.43, accuracy: 0.1, "GZ334")
        XCTAssertEqual(day16[2521], 107.69, accuracy: 0.1, "HA334")
        XCTAssertEqual(day16[2886], 442.87, accuracy: 0.1, "HB334")
        XCTAssertEqual(day16[3251], 782.16, accuracy: 0.1, "HC334")
        XCTAssertEqual(day16[3616], 139.30, accuracy: 0.1, "HD334")
        XCTAssertEqual(day16[3981], 0.00, accuracy: 0.1, "HE334")
        XCTAssertEqual(day16[4346], 63.34, accuracy: 0.1, "HF334")
        XCTAssertEqual(day16[4711], 0.00, accuracy: 0.1, "HG334")
        XCTAssertEqual(day16[5076], 13.34, accuracy: 0.1, "HH334")
        XCTAssertEqual(day16[5441], 128.06, accuracy: 0.1, "HI334")
        XCTAssertEqual(day16[5806], 0.00, accuracy: 0.1, "HJ334")
        XCTAssertEqual(day16[6171], 47.27, accuracy: 0.1, "HK334")
        XCTAssertEqual(day16[6536], 32.73, accuracy: 0.1, "HL334")
        XCTAssertEqual(day16[6901], 0.00, accuracy: 0.1, "HM334")
        XCTAssertEqual(day16[7266], 0.00, accuracy: 0.1, "HN334")
        XCTAssertEqual(day16[7631], 3260.32, accuracy: 0.1, "HO334")
        XCTAssertEqual(day16[7996], 2416.19, accuracy: 0.1, "HP334")
        XCTAssertEqual(day16[8361], 170.12, accuracy: 0.1, "HQ334")
        XCTAssertEqual(day16[8726], 325.55, accuracy: 0.1, "HR334")
        XCTAssertEqual(day16[9091], 99.84, accuracy: 0.1, "HS334")
        XCTAssertEqual(day16[9456], 64.48, accuracy: 0.1, "HT334")
        XCTAssertEqual(day16[9821], 185.71, accuracy: 0.1, "HU334")
        XCTAssertEqual(day16[10186], 185.71, accuracy: 0.1, "HV334")
        XCTAssertEqual(day16[10551], 170.12, accuracy: 0.1, "HW334")
        XCTAssertEqual(day16[10916], 450.00, accuracy: 0.1, "HX334")
        XCTAssertEqual(day16[11281], 400.00, accuracy: 0.1, "HY334")
        XCTAssertEqual(day16[11646], 170.12, accuracy: 0.1, "HZ334")
        XCTAssertEqual(day16[12011], 450.00, accuracy: 0.1, "IA334")
        XCTAssertEqual(day16[12376], 400.00, accuracy: 0.1, "IB334")
        XCTAssertEqual(day16[12741], 750.00, accuracy: 0.1, "IC334")
        XCTAssertEqual(day16[13106], 886.66, accuracy: 0.1, "ID334")
        XCTAssertEqual(day16[13471], 771.94, accuracy: 0.1, "IE334")
        XCTAssertEqual(day16[13836], 1500.00, accuracy: 0.1, "IF334")
        XCTAssertEqual(day16[14201], 309.36, accuracy: 0.1, "IG334")
        XCTAssertEqual(day16[14566], 195.42, accuracy: 0.1, "IH334")
        XCTAssertEqual(day16[14931], 750.00, accuracy: 0.1, "II334")
        XCTAssertEqual(day16[15296], 101.37, accuracy: 0.1, "IJ334")
        XCTAssertEqual(day16[15661], 1.20, accuracy: 0.1, "IK334")
        XCTAssertEqual(day16[16026], 375.00, accuracy: 0.1, "IL334")
        XCTAssertEqual(day16[16391], 56.63, accuracy: 0.1, "IM334")
        XCTAssertEqual(day16[16756], 42.86, accuracy: 0.1, "IN334")
        XCTAssertEqual(day16[17121], 122.73, accuracy: 0.1, "IO334")
      }

      let day17 = model.day(case: j, day1: day1, day5: day15, day6: day16)
      if j == 0 {
      print("Daily 1 Case", j)
      Array(day17[..<7665]).head(250, steps: 365)
      print("Daily 1 Case", j)
      Array(day17[7665..<13505]).head(272, steps: 365)
      print("Daily 1 Case", j)
      Array(day17[13505..<19345]).head(289, steps: 365)
      print("Daily 1 Case", j)
      Array(day17[19345..<31755]).head(306, steps: 365)
      print("Daily 1 Case", j)
      Array(day17[31755...]).head(341, steps: 365)
      }
      if j == 0 {
        XCTAssertEqual(day17[330], -157.80, accuracy: 0.1, "IQ333")
        XCTAssertEqual(day17[695], -544.24, accuracy: 0.1, "IR333")
        XCTAssertEqual(day17[1060], -900.96, accuracy: 0.1, "IS333")
        XCTAssertEqual(day17[1425], -156.22, accuracy: 0.1, "IT333")
        XCTAssertEqual(day17[1790], -571.58, accuracy: 0.1, "IU333")
        XCTAssertEqual(day17[2155], -523.75, accuracy: 0.1, "IV333")
        XCTAssertEqual(day17[2520], 41.56, accuracy: 0.1, "IW333")
        XCTAssertEqual(day17[2885], -63.47, accuracy: 0.1, "IX333")
        XCTAssertEqual(day17[3250], -266.73, accuracy: 0.1, "IY333")
        XCTAssertEqual(day17[3615], 120.14, accuracy: 0.1, "IZ333")
        XCTAssertEqual(day17[3980], 120.14, accuracy: 0.1, "JA333")
        XCTAssertEqual(day17[4345], 120.14, accuracy: 0.1, "JB333")
        XCTAssertEqual(day17[4710], 24.96, accuracy: 0.1, "JC333")
        XCTAssertEqual(day17[5075], -25.01, accuracy: 0.1, "JD333")
        XCTAssertEqual(day17[5440], -77.53, accuracy: 0.1, "JE333")
        XCTAssertEqual(day17[5805], -129.69, accuracy: 0.1, "JF333")
        XCTAssertEqual(day17[6170], -173.62, accuracy: 0.1, "JG333")
        XCTAssertEqual(day17[6535], -219.80, accuracy: 0.1, "JH333")
        XCTAssertEqual(day17[6900], 20.11, accuracy: 0.1, "JI333")
        XCTAssertEqual(day17[7265], 14.07, accuracy: 0.1, "JJ333")
        XCTAssertEqual(day17[7630], 7.72, accuracy: 0.1, "JK333")

        XCTAssertEqual(day17[331], 1865.95, accuracy: 0.1, "IQ334")
        XCTAssertEqual(day17[696], 1272.76, accuracy: 0.1, "IR334")
        XCTAssertEqual(day17[1061], 743.84, accuracy: 0.1, "IS334")
        XCTAssertEqual(day17[1426], 715.93, accuracy: 0.1, "IT334")
        XCTAssertEqual(day17[1791], 578.36, accuracy: 0.1, "IU334")
        XCTAssertEqual(day17[2156], 375.51, accuracy: 0.1, "IV334")
        XCTAssertEqual(day17[2521], 714.20, accuracy: 0.1, "IW334")
        XCTAssertEqual(day17[2886], 575.25, accuracy: 0.1, "IX334")
        XCTAssertEqual(day17[3251], 371.50, accuracy: 0.1, "IY334")
        XCTAssertEqual(day17[3616], 185.71, accuracy: 0.1, "IZ334")
        XCTAssertEqual(day17[3981], 185.71, accuracy: 0.1, "JA334")
        XCTAssertEqual(day17[4346], 185.71, accuracy: 0.1, "JB334")
        XCTAssertEqual(day17[4711], 74.96, accuracy: 0.1, "JC334")
        XCTAssertEqual(day17[5076], 9.36, accuracy: 0.1, "JD334")
        XCTAssertEqual(day17[5441], -38.98, accuracy: 0.1, "JE334")
        XCTAssertEqual(day17[5806], -104.69, accuracy: 0.1, "JF334")
        XCTAssertEqual(day17[6171], -162.36, accuracy: 0.1, "JG334")
        XCTAssertEqual(day17[6536], -204.86, accuracy: 0.1, "JH334")
        XCTAssertEqual(day17[6901], 28.29, accuracy: 0.1, "JI334")
        XCTAssertEqual(day17[7266], 20.36, accuracy: 0.1, "JJ334")
        XCTAssertEqual(day17[7631], 14.51, accuracy: 0.1, "JK334")
      }

      if j == 2 {

      }

      day.append(Array(day17[day11start..<day11end]))
      day.append(Array(day17[day12start..<day12end]))

      let day0 = model.day0(hour0: hour0)
      let day21 = model.day1(case: j, day0: day0)
      print("Daily 2 Case", j)
      Array(day21[0..<6935]).head(0, steps: 365)
      print("Daily 2 Case", j)
      Array(day21[6935...]).head(19, steps: 365)
      if j == 0 {
        XCTAssertEqual(day21[329], 136.32, accuracy: 0.05, "E333")
        XCTAssertEqual(day21[694], 149.51, accuracy: 0.05, "F333")
        XCTAssertEqual(day21[1059], 333.43, accuracy: 0.05, "G333")
        XCTAssertEqual(day21[1424], 543.74, accuracy: 0.05, "H333")
        XCTAssertEqual(day21[1789], 234.40, accuracy: 0.05, "I333")
        XCTAssertEqual(day21[2154], 468.80, accuracy: 0.05, "J333")
        XCTAssertEqual(day21[2519], 0.00, accuracy: 0.05, "K333")
        XCTAssertEqual(day21[2884], 0.00, accuracy: 0.05, "L333")
        XCTAssertEqual(day21[3249], 0.00, accuracy: 0.05, "M333")
        XCTAssertEqual(day21[3614], 0.00, accuracy: 0.05, "N333")
        XCTAssertEqual(day21[3979], 1673.42, accuracy: 0.05, "O333")
        XCTAssertEqual(day21[4344], 3291.09, accuracy: 0.05, "P333")
        XCTAssertEqual(day21[4709], 497.36, accuracy: 0.05, "Q333")
        XCTAssertEqual(day21[5074], 985.02, accuracy: 0.05, "R333")
        XCTAssertEqual(day21[5439], 234.40, accuracy: 0.05, "S333")
        XCTAssertEqual(day21[5804], 468.80, accuracy: 0.05, "T333")
        XCTAssertEqual(day21[6169], 206.06, accuracy: 0.05, "U333")
        XCTAssertEqual(day21[6534], 412.12, accuracy: 0.05, "V333")
        XCTAssertEqual(day21[6899], 28.34, accuracy: 0.05, "W333")
        XCTAssertEqual(day21[7264], 56.68, accuracy: 0.05, "X333")
        XCTAssertEqual(day21[7629], 0.22, accuracy: 0.05, "Y333")
        XCTAssertEqual(day21[7994], -0.56, accuracy: 0.05, "Z333")
        XCTAssertEqual(day21[8359], 1.00, accuracy: 0.05, "AA333")
        XCTAssertEqual(day21[8724], 1.00, accuracy: 0.05, "AB333")
        XCTAssertEqual(day21[9089], 1.00, accuracy: 0.05, "AC333")
        XCTAssertEqual(day21[9454], 1.00, accuracy: 0.05, "AD333")
        XCTAssertEqual(day21[9819], 0.70, accuracy: 0.05, "AE333")
      }
      if j == 1 {
        XCTAssertEqual(day21[329], 150.55, accuracy: 0.05, "AG333")
        XCTAssertEqual(day21[694], 180.55, accuracy: 0.05, "AH333")
        XCTAssertEqual(day21[1059], 189.31, accuracy: 0.05, "AI333")
        XCTAssertEqual(day21[1424], 334.84, accuracy: 0.05, "AJ333")
        XCTAssertEqual(day21[1789], 0.00, accuracy: 0.05, "AK333")
        XCTAssertEqual(day21[2154], 0.00, accuracy: 0.05, "AL333")
        XCTAssertEqual(day21[2519], 206.06, accuracy: 0.05, "AM333")
        XCTAssertEqual(day21[2884], 412.12, accuracy: 0.05, "AN333")
        XCTAssertEqual(day21[3249], 28.34, accuracy: 0.05, "AO333")
        XCTAssertEqual(day21[3614], 56.68, accuracy: 0.05, "AP333")
        XCTAssertEqual(day21[3979], 1656.63, accuracy: 0.05, "AQ333")
        XCTAssertEqual(day21[4344], 3257.50, accuracy: 0.05, "AR333")
        XCTAssertEqual(day21[4709], 562.14, accuracy: 0.05, "AS333")
        XCTAssertEqual(day21[5074], 1114.59, accuracy: 0.05, "AT333")
        XCTAssertEqual(day21[5439], 0.00, accuracy: 0.05, "AU333")
        XCTAssertEqual(day21[5804], 0.00, accuracy: 0.05, "AV333")
        XCTAssertEqual(day21[6169], 206.06, accuracy: 0.05, "AW333")
        XCTAssertEqual(day21[6534], 412.12, accuracy: 0.05, "AX333")
        XCTAssertEqual(day21[6899], 28.34, accuracy: 0.05, "AY333")
        XCTAssertEqual(day21[7264], 56.68, accuracy: 0.05, "AZ333")
        XCTAssertEqual(day21[7629], 1.00, accuracy: 0.05, "BA333")
        XCTAssertEqual(day21[7994], 1.00, accuracy: 0.05, "BB333")
        XCTAssertEqual(day21[8359], 0.96, accuracy: 0.05, "BC333")
        XCTAssertEqual(day21[8724], 0.92, accuracy: 0.05, "BD333")
        XCTAssertEqual(day21[9089], 0.53, accuracy: 0.05, "BE333")
        XCTAssertEqual(day21[9454], 0.06, accuracy: 0.05, "BF333")
        XCTAssertEqual(day21[9819], 1.10, accuracy: 0.05, "BG333")
      }
      if j == 2 {
        XCTAssertEqual(day21[329], 168.15, accuracy: 0.05, "BI333")
        XCTAssertEqual(day21[694], 208.10, accuracy: 0.05, "BJ333")
        XCTAssertEqual(day21[1059], 394.23, accuracy: 0.05, "BK333")
        XCTAssertEqual(day21[1424], 682.49, accuracy: 0.05, "BL333")
        XCTAssertEqual(day21[1789], 0.00, accuracy: 0.05, "BM333")
        XCTAssertEqual(day21[2154], 0.00, accuracy: 0.05, "BN333")
        XCTAssertEqual(day21[2519], 0.00, accuracy: 0.05, "BO333")
        XCTAssertEqual(day21[2884], 0.00, accuracy: 0.05, "BP333")
        XCTAssertEqual(day21[3249], 28.34, accuracy: 0.05, "BQ333")
        XCTAssertEqual(day21[3614], 51.58, accuracy: 0.05, "BR333")
        XCTAssertEqual(day21[3979], 1637.90, accuracy: 0.05, "BS333")
        XCTAssertEqual(day21[4344], 2935.05, accuracy: 0.05, "BT333")
        XCTAssertEqual(day21[4709], 356.09, accuracy: 0.05, "BU333")
        XCTAssertEqual(day21[5074], 640.08, accuracy: 0.05, "BV333")
        XCTAssertEqual(day21[5439], 0.00, accuracy: 0.05, "BW333")
        XCTAssertEqual(day21[5804], 0.00, accuracy: 0.05, "BX333")
        XCTAssertEqual(day21[6169], 0.00, accuracy: 0.05, "BY333")
        XCTAssertEqual(day21[6534], 0.00, accuracy: 0.05, "BZ333")
        XCTAssertEqual(day21[6899], 28.34, accuracy: 0.05, "CA333")
        XCTAssertEqual(day21[7264], 51.58, accuracy: 0.05, "CB333")
        XCTAssertEqual(day21[7629], 1.00, accuracy: 0.05, "CC333")
        XCTAssertEqual(day21[7994], 1.00, accuracy: 0.05, "CD333")
        XCTAssertEqual(day21[8359], 1.00, accuracy: 0.05, "CE333")
        XCTAssertEqual(day21[8724], 1.00, accuracy: 0.05, "CF333")
        XCTAssertEqual(day21[9089], 0.53, accuracy: 0.05, "CG333")
        XCTAssertEqual(day21[9454], 0.14, accuracy: 0.05, "CH333")
        XCTAssertEqual(day21[9819], 1.00, accuracy: 0.05, "CI333")
      }
      if j == 3 {
        XCTAssertEqual(day21[329], 1747.79, accuracy: 0.05, "CK333")
        XCTAssertEqual(day21[694], 3084.89, accuracy: 0.05, "CL333")
        XCTAssertEqual(day21[1059], 738.12, accuracy: 0.05, "CM333")
        XCTAssertEqual(day21[1424], 1310.37, accuracy: 0.05, "CN333")
        XCTAssertEqual(day21[1789], 0.00, accuracy: 0.05, "CO333")
        XCTAssertEqual(day21[2154], 0.00, accuracy: 0.05, "CP333")
        XCTAssertEqual(day21[2519], 0.00, accuracy: 0.05, "CQ333")
        XCTAssertEqual(day21[2884], 0.00, accuracy: 0.05, "CR333")
        XCTAssertEqual(day21[3249], 0.00, accuracy: 0.05, "CS333")
        XCTAssertEqual(day21[3614], 0.00, accuracy: 0.05, "CT333")
        XCTAssertEqual(day21[3979], 55.76, accuracy: 0.05, "CU333")
        XCTAssertEqual(day21[4344], 55.76, accuracy: 0.05, "CV333")
        XCTAssertEqual(day21[4709], 9.70, accuracy: 0.05, "CW333")
        XCTAssertEqual(day21[5074], 9.70, accuracy: 0.05, "CX333")
        XCTAssertEqual(day21[5439], 0.00, accuracy: 0.05, "CY333")
        XCTAssertEqual(day21[5804], 0.00, accuracy: 0.05, "CZ333")
        XCTAssertEqual(day21[6169], 0.00, accuracy: 0.05, "DA333")
        XCTAssertEqual(day21[6534], 0.00, accuracy: 0.05, "DB333")
        XCTAssertEqual(day21[6899], 0.00, accuracy: 0.05, "DC333")
        XCTAssertEqual(day21[7264], 0.00, accuracy: 0.05, "DD333")
        XCTAssertEqual(day21[7629], 1.00, accuracy: 0.05, "DE333")
        XCTAssertEqual(day21[7994], 1.00, accuracy: 0.05, "DF333")
        XCTAssertEqual(day21[8359], 1.00, accuracy: 0.05, "DG333")
        XCTAssertEqual(day21[8724], 1.00, accuracy: 0.05, "DH333")
        XCTAssertEqual(day21[9089], 1.00, accuracy: 0.05, "DI333")
        XCTAssertEqual(day21[9454], 1.00, accuracy: 0.05, "DJ333")
        XCTAssertEqual(day21[9819], 1.00, accuracy: 0.05, "DK333")
      }
 
      let day27 = model.day(case: j, day0: day0, day1: day21, day6: day6)
      
      print("Daily 2 Case", j)
      Array(day27[..<9855]).head(121, steps: 365)
      print("Daily 2 Case", j)
      Array(day27[9855..<17155]).head(148, steps: 365)
      print("Daily 2 Case", j)
      Array(day27[17155..<24090]).head(168, steps: 365)
      print("Daily 2 Case", j)
      Array(day27[24090..<31755]).head(188, steps: 365)
      print("Daily 2 Case", j)
      Array(day27[31755..<38690]).head(206, steps: 365)
      print("Daily 2 Case", j)
      Array(day27[38690...]).head(242, steps: 365)
      
      day.append(Array(day27[day21start..<day21end]))
      day.append(Array(day27[day22start..<day22end]))
    }
    let costs = Costs(model)
    var year = [Double?]()
    var meth_produced_MTPH_sum = Double.zero
    var elec_from_grid_sum = Double.zero
    var elec_to_grid_MTPH_sum = Double.zero

    for d in 0..<365 {
      let cases = day.indices.map { i in
        costs.LCOM(meth_produced_MTPH: day[i][d], elec_from_grid: day[i][d+365], elec_to_grid: day[i][d+365+365])
      }
      let best = cases.indices.filter{cases[$0].isFinite}.filter{cases[$0]>0}.sorted()
      if best.count > 0 { 
        meth_produced_MTPH_sum += day[best[0]][d]
        elec_from_grid_sum += day[best[0]][d+365]
        elec_to_grid_MTPH_sum += day[best[0]][d+365+365]
        year.append(cases[best[0]])
      } else { year.append(nil) } 
    }    
    let LCOM = costs.LCOM(meth_produced_MTPH: meth_produced_MTPH_sum, elec_from_grid: elec_from_grid_sum, elec_to_grid: elec_to_grid_MTPH_sum)
    print(LCOM)
  }
}
