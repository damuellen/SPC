import Utilities
import XCTest
import xlsxwriter

@testable import SunOl

class SunOlTests: XCTestCase {
  func testsCalculation() {
    let path = "/workspaces/SPC/input.txt"
    guard let csv = CSV(atPath: path) else {
      print("No input.")
      return
    }
    TunOl.Q_Sol_MW_thLoop = [0] + csv["csp"]
    TunOl.Reference_PV_plant_power_at_inverter_inlet_DC = [0] + csv["pv"]
    TunOl.Reference_PV_MV_power_at_transformer_outlet = [0] + csv["out"]

    let model = TunOl([])
    let hour0 = model.hour0(
      TunOl.Q_Sol_MW_thLoop, TunOl.Reference_PV_plant_power_at_inverter_inlet_DC, TunOl.Reference_PV_MV_power_at_transformer_outlet)
    XCTAssertEqual(hour0[9113], 0.28, accuracy: 0.1, "H357")
    XCTAssertEqual(hour0[17873], 0.95, accuracy: 0.1, "I357")
    XCTAssertEqual(hour0[26633], 36.00, accuracy: 0.1, "J357")
    XCTAssertEqual(hour0[35393], 244.09, accuracy: 0.1, "K357")
    XCTAssertEqual(hour0[44153], 232.51, accuracy: 0.1, "L357")
    XCTAssertEqual(hour0[52913], 0.00, accuracy: 0.1, "M357")
    XCTAssertEqual(hour0[61673], 2.28, accuracy: 0.1, "O357")
    XCTAssertEqual(hour0[70433], 230.23, accuracy: 0.1, "P357")
    XCTAssertEqual(hour0[79193], 0.00, accuracy: 0.1, "Q357")
    XCTAssertEqual(hour0[87953], 116.52, accuracy: 0.1, "R357")
    XCTAssertEqual(hour0[96713], 116.52, accuracy: 0.1, "S357")
    XCTAssertEqual(hour0[105473], 49.21, accuracy: 0.1, "T357")
    XCTAssertEqual(hour0[114233], 15.00, accuracy: 0.1, "U357")
    XCTAssertEqual(hour0[122993], 100.36, accuracy: 0.1, "V357")
    XCTAssertEqual(hour0[131753], 0.00, accuracy: 0.1, "W357")
    XCTAssertEqual(hour0[140513], 0.00, accuracy: 0.1, "X357")
    XCTAssertEqual(hour0[149273], 50.00, accuracy: 0.1, "Y357")
    XCTAssertEqual(hour0[158033], 13.34, accuracy: 0.1, "Z357")
    XCTAssertEqual(hour0[166793], 86.66, accuracy: 0.1, "AA357")
    XCTAssertEqual(hour0[175553], 34.37, accuracy: 0.1, "AB357")
    XCTAssertEqual(hour0[184313], 11.26, accuracy: 0.1, "AC357")
    XCTAssertEqual(hour0[193073], 6.29, accuracy: 0.1, "AD357")
    XCTAssertEqual(hour0[201833], 65.00, accuracy: 0.1, "AE357")
    XCTAssertEqual(hour0[210593], 50.00, accuracy: 0.1, "AF357")
    XCTAssertEqual(hour0[219353], 205.66, accuracy: 0.1, "AG357")
    XCTAssertEqual(hour0[228113], 205.66, accuracy: 0.1, "AH357")
    XCTAssertEqual(hour0[236873], 87.36, accuracy: 0.1, "AI357")
    XCTAssertEqual(hour0[245633], 0.00, accuracy: 0.1, "AJ357")
    XCTAssertEqual(hour0[254393], 0.00, accuracy: 0.1, "AK357")
    XCTAssertEqual(hour0[263153], 27.31, accuracy: 0.1, "AL357")
    XCTAssertEqual(hour0[271913], 22.69, accuracy: 0.1, "AM357")
    XCTAssertEqual(hour0[280673], 51.88, accuracy: 0.1, "AN357")
    XCTAssertEqual(hour0[289433], 48.12, accuracy: 0.1, "AO357")
    XCTAssertEqual(hour0[298193], 21.56, accuracy: 0.1, "AP357")
    XCTAssertEqual(hour0[306953], 0.00, accuracy: 0.1, "AQ357")
    XCTAssertEqual(hour0[315713], 4.74, accuracy: 0.1, "AR357")
    XCTAssertEqual(hour0[324473], 0.00, accuracy: 0.1, "AS357")
    XCTAssertEqual(hour0[333233], 0.00, accuracy: 0.1, "AT357")
    let hour1 = model.hour1(hour0: hour0)

    XCTAssertEqual(hour1[353], 0.36, accuracy: 0.1, "AV357")
    XCTAssertEqual(hour1[9113], 232.15, accuracy: 0.1, "AW357")
    XCTAssertEqual(hour1[17873], 0.00, accuracy: 0.1, "AX357")
    XCTAssertEqual(hour1[26633], 0.00, accuracy: 0.1, "AY357")
    XCTAssertEqual(hour1[35393], 1739.03, accuracy: 0.1, "AZ357")
    XCTAssertEqual(hour1[44153], 0.00, accuracy: 0.1, "BA357")
    XCTAssertEqual(hour1[52913], 0.00, accuracy: 0.1, "BB357")
    XCTAssertEqual(hour1[61673], 0.00, accuracy: 0.1, "BC357")
    XCTAssertEqual(hour1[70433], 0.00, accuracy: 0.1, "BD357")
    XCTAssertEqual(hour1[79193], 0.00, accuracy: 0.1, "BE357")
    XCTAssertEqual(hour1[87953], 0.00, accuracy: 0.1, "BF357")
    XCTAssertEqual(hour1[96713], 0.00, accuracy: 0.1, "BG357")
    XCTAssertEqual(hour1[105473], 0.00, accuracy: 0.1, "BH357")
    XCTAssertEqual(hour1[114233], 232.15, accuracy: 0.1, "BI357")
    XCTAssertEqual(hour1[122993], 36.00, accuracy: 0.1, "BJ357")
    XCTAssertEqual(hour1[131753], 0.00, accuracy: 0.1, "BK357")
    XCTAssertEqual(hour1[140513], 116.52, accuracy: 0.1, "BL357")
    XCTAssertEqual(hour1[149273], 116.52, accuracy: 0.1, "BM357")
    XCTAssertEqual(hour1[158033], 49.21, accuracy: 0.1, "BN357")
    XCTAssertEqual(hour1[166793], 15.00, accuracy: 0.1, "BO357")
    XCTAssertEqual(hour1[175553], 102.29, accuracy: 0.1, "BP357")
    XCTAssertEqual(hour1[184313], 0.00, accuracy: 0.1, "BQ357")

    let day6 = model.day(hour0: hour0)
    var day = [[Double]]()
    let dayLVstart = 29200
    let dayMBend = 31390 + 365
    let dayNEstart = 41610
    let dayNKend = 43800 + 365

    let dayIPstart = 32120
    let dayIXend = 35040 + 365
    let dayJUstart = 43070
    let dayKCend = 45990 + 365

    for j in 0..<4 {
      let hour2 = model.hour2(j: j, hour0: hour0, hour1: hour1)
      if j == 0 {
        XCTAssertEqual(hour2[353], 0.00, accuracy: 0.1, "BU357")
        XCTAssertEqual(hour2[9113], 0.00, accuracy: 0.1, "BV357")
        XCTAssertEqual(hour2[17873], 0.00, accuracy: 0.1, "BW357")
        XCTAssertEqual(hour2[26633], 0.00, accuracy: 0.1, "BX357")
        XCTAssertEqual(hour2[35393], 0.00, accuracy: 0.1, "BY357")
        XCTAssertEqual(hour2[44153], 161.25, accuracy: 0.1, "BZ357")
        XCTAssertEqual(hour2[52913], 0.00, accuracy: 0.1, "CA357")
        XCTAssertEqual(hour2[61673], 0.00, accuracy: 0.1, "CB357")
        XCTAssertEqual(hour2[70433], 1414.47, accuracy: 0.1, "CC357")
        XCTAssertEqual(hour2[79193], 324.56, accuracy: 0.1, "CD357")
        XCTAssertEqual(hour2[87953], 0.00, accuracy: 0.1, "CE357")
        XCTAssertEqual(hour2[96713], 0.00, accuracy: 0.1, "CF357")
        XCTAssertEqual(hour2[105473], 0.00, accuracy: 0.1, "CG357")
        XCTAssertEqual(hour2[114233], 0.00, accuracy: 0.1, "CH357")
        XCTAssertEqual(hour2[122993], 0.00, accuracy: 0.1, "CI357")
        XCTAssertEqual(hour2[131753], 0.00, accuracy: 0.1, "CJ357")
        XCTAssertEqual(hour2[140513], 232.51, accuracy: 0.1, "CK357")
        XCTAssertEqual(hour2[149273], 36.00, accuracy: 0.1, "CL357")
        XCTAssertEqual(hour2[158033], 5.59, accuracy: 0.1, "CM357")
        XCTAssertEqual(hour2[166793], 0.00, accuracy: 0.1, "CN357")
      }
      let hour3 = model.hour3(j: j, hour0: hour0, hour1: hour1, hour2: hour2)
      if j == 0 {
        XCTAssertEqual(hour3[353], 116.52, accuracy: 0.1, "CP357")
        XCTAssertEqual(hour3[9113], 116.52, accuracy: 0.1, "CQ357")
        XCTAssertEqual(hour3[17873], 49.21, accuracy: 0.1, "CR357")
        XCTAssertEqual(hour3[353], 116.52, accuracy: 0.1, "CP357")
        XCTAssertEqual(hour3[35393], 0.00, accuracy: 0.1, "CT357")
        XCTAssertEqual(hour3[44153], 0.00, accuracy: 0.1, "CU357")
        XCTAssertEqual(hour3[52913], 97.06, accuracy: 0.1, "CV357")
        XCTAssertEqual(hour3[61673], 0.00, accuracy: 0.1, "CW357")
        XCTAssertEqual(hour3[70433], 0.00, accuracy: 0.1, "CX357")
        XCTAssertEqual(hour3[79193], 50.00, accuracy: 0.1, "CY357")
        XCTAssertEqual(hour3[87953], 13.34, accuracy: 0.1, "CZ357")
        XCTAssertEqual(hour3[96713], 86.66, accuracy: 0.1, "DA357")
        XCTAssertEqual(hour3[105473], 34.37, accuracy: 0.1, "DB357")
        XCTAssertEqual(hour3[114233], 11.26, accuracy: 0.1, "DC357")
        XCTAssertEqual(hour3[122993], 6.29, accuracy: 0.1, "DD357")
        XCTAssertEqual(hour3[131753], 65.00, accuracy: 0.1, "DE357")
        XCTAssertEqual(hour3[140513], 50.00, accuracy: 0.1, "DF357")
        XCTAssertEqual(hour3[149273], 205.66, accuracy: 0.1, "DG357")
        XCTAssertEqual(hour3[158033], 205.66, accuracy: 0.1, "DH357")
        XCTAssertEqual(hour3[166793], 87.36, accuracy: 0.1, "DI357")
        XCTAssertEqual(hour3[175553], 0.00, accuracy: 0.1, "DJ357")
        XCTAssertEqual(hour3[184313], 0.00, accuracy: 0.1, "DK357")
        XCTAssertEqual(hour3[193073], 30.62, accuracy: 0.1, "DL357")
        XCTAssertEqual(hour3[201833], 19.38, accuracy: 0.1, "DM357")
        XCTAssertEqual(hour3[210593], 51.88, accuracy: 0.1, "DN357")
        XCTAssertEqual(hour3[219353], 48.12, accuracy: 0.1, "DO357")
        XCTAssertEqual(hour3[228113], 21.56, accuracy: 0.1, "DP357")
        XCTAssertEqual(hour3[236873], 0.00, accuracy: 0.1, "DQ357")
        XCTAssertEqual(hour3[245633], 4.74, accuracy: 0.1, "DR357")
        XCTAssertEqual(hour3[254393], 0.00, accuracy: 0.1, "DS357")
        XCTAssertEqual(hour3[263153], 0.00, accuracy: 0.1, "DT357")
      }
      var day1 = model.day(case: j, hour2: hour2, hour3: hour3)
      if j == 0 {
        XCTAssertEqual(day1[330], 15.00, accuracy: 0.1, "C333")
        XCTAssertEqual(day1[695], 9.00, accuracy: 0.1, "D333")
        XCTAssertEqual(day1[1060], 14.00, accuracy: 0.1, "E333")
        XCTAssertEqual(day1[1425], 234.40, accuracy: 0.1, "F333")
        XCTAssertEqual(day1[1790], 468.80, accuracy: 0.1, "G333")
        XCTAssertEqual(day1[3615], 0.22, accuracy: 0.1, "L333")
        XCTAssertEqual(day1[3980], -0.56, accuracy: 0.1, "M333")
        XCTAssertEqual(day1[4345], 1.00, accuracy: 0.1, "N333")
        XCTAssertEqual(day1[4710], 1.00, accuracy: 0.1, "O333")
        XCTAssertEqual(day1[5075], 1.00, accuracy: 0.1, "P333")
        XCTAssertEqual(day1[5440], 1.00, accuracy: 0.1, "Q333")
        XCTAssertEqual(day1[5805], 0.70, accuracy: 0.1, "R333")
      }

      
      let hour4 = model.hour4(j: j, day1: day1, hour0: hour0, hour1: hour1, hour2: hour2)
      if j == 0 {
        XCTAssertEqual(hour4[9113], 0.00, accuracy: 0.1, "DW357")
        XCTAssertEqual(hour4[17873], 0.00, accuracy: 0.1, "DX357")
        XCTAssertEqual(hour4[26633], 2.57, accuracy: 0.1, "DY357")
        XCTAssertEqual(hour4[35393], 0.00, accuracy: 0.1, "DZ357")
        XCTAssertEqual(hour4[44153], 0.00, accuracy: 0.1, "EA357")
        XCTAssertEqual(hour4[52913], 161.25, accuracy: 0.1, "EB357")
        XCTAssertEqual(hour4[61673], 0.00, accuracy: 0.1, "EC357")
        XCTAssertEqual(hour4[70433], 0.00, accuracy: 0.1, "ED357")
        XCTAssertEqual(hour4[79193], 1406.73, accuracy: 0.1, "EE357")
        XCTAssertEqual(hour4[87953], 0.00, accuracy: 0.1, "EF357")
        XCTAssertEqual(hour4[96713], 0.00, accuracy: 0.1, "EG357")
        XCTAssertEqual(hour4[105473], 0.00, accuracy: 0.1, "EH357")
        XCTAssertEqual(hour4[9113], 0.00, accuracy: 0.1, "DW357")
        XCTAssertEqual(hour4[122993], 1406.73, accuracy: 0.1, "EJ357")
        XCTAssertEqual(hour4[131753], 332.30, accuracy: 0.1, "EK357")
        XCTAssertEqual(hour4[140513], 0.00, accuracy: 0.1, "EL357")
        XCTAssertEqual(hour4[149273], 0.00, accuracy: 0.1, "EM357")
        XCTAssertEqual(hour4[158033], 0.00, accuracy: 0.1, "EN357")
        XCTAssertEqual(hour4[166793], 0.00, accuracy: 0.1, "EO357")
        XCTAssertEqual(hour4[175553], 0.00, accuracy: 0.1, "EP357")
        XCTAssertEqual(hour4[184313], 0.00, accuracy: 0.1, "EQ357")
        XCTAssertEqual(hour4[193073], 232.51, accuracy: 0.1, "ER357")
        XCTAssertEqual(hour4[201833], 36.00, accuracy: 0.1, "ES357")
        XCTAssertEqual(hour4[210593], 5.59, accuracy: 0.1, "ET357")
        XCTAssertEqual(hour4[219353], 0.00, accuracy: 0.1, "EU357")
        XCTAssertEqual(hour4[228113], 116.52, accuracy: 0.1, "EW357")
        XCTAssertEqual(hour4[236873], 116.52, accuracy: 0.1, "EX357")
        XCTAssertEqual(hour4[245633], 49.21, accuracy: 0.1, "EY357")
        XCTAssertEqual(hour4[254393], 15.00, accuracy: 0.1, "EZ357")
        XCTAssertEqual(hour4[263153], 0.00, accuracy: 0.1, "FA357")
        XCTAssertEqual(hour4[271913], 0.00, accuracy: 0.1, "FB357")
        XCTAssertEqual(hour4[280673], 97.06, accuracy: 0.1, "FC357")
        XCTAssertEqual(hour4[289433], 0.00, accuracy: 0.1, "FD357")
        XCTAssertEqual(hour4[298193], 0.00, accuracy: 0.1, "FE357")
        XCTAssertEqual(hour4[306953], 50.00, accuracy: 0.1, "FF357")
        XCTAssertEqual(hour4[315713], 13.34, accuracy: 0.1, "FG357")
        XCTAssertEqual(hour4[324473], 86.66, accuracy: 0.1, "FH357")
        XCTAssertEqual(hour4[333233], 34.37, accuracy: 0.1, "FI357")
        XCTAssertEqual(hour4[341993], 11.26, accuracy: 0.1, "FJ357")
        XCTAssertEqual(hour4[350753], 6.29, accuracy: 0.1, "FK357")
        XCTAssertEqual(hour4[359513], 65.00, accuracy: 0.1, "FL357")
        XCTAssertEqual(hour4[368273], 50.00, accuracy: 0.1, "FM357")
        XCTAssertEqual(hour4[377033], 205.66, accuracy: 0.1, "FN357")
        XCTAssertEqual(hour4[385793], 205.66, accuracy: 0.1, "FO357")
        XCTAssertEqual(hour4[394553], 87.36, accuracy: 0.1, "FP357")
        XCTAssertEqual(hour4[403313], 0.00, accuracy: 0.1, "FQ357")
        XCTAssertEqual(hour4[412073], 0.00, accuracy: 0.1, "FR357")
        XCTAssertEqual(hour4[420833], 30.62, accuracy: 0.1, "FS357")
        XCTAssertEqual(hour4[429593], 19.38, accuracy: 0.1, "FT357")
        XCTAssertEqual(hour4[438353], 51.88, accuracy: 0.1, "FU357")
        XCTAssertEqual(hour4[447113], 48.12, accuracy: 0.1, "FV357")
        XCTAssertEqual(hour4[455873], 21.56, accuracy: 0.1, "FW357")
        XCTAssertEqual(hour4[464633], 0.00, accuracy: 0.1, "FX357")
        XCTAssertEqual(hour4[473393], 4.74, accuracy: 0.1, "FY357")
        XCTAssertEqual(hour4[482153], 0.00, accuracy: 0.1, "FZ357")
        XCTAssertEqual(hour4[490913], 0.00, accuracy: 0.1, "GA357")
      }
      model.night(case: j, day1: &day1, hour3: hour3, hour4: hour4)
      if j == 0 {
        XCTAssertEqual(day1[6170], 15.00, accuracy: 0.1, "T333")
        XCTAssertEqual(day1[6535], 9.00, accuracy: 0.1, "U333")
        XCTAssertEqual(day1[6900], 14.00, accuracy: 0.1, "V333")
        XCTAssertEqual(day1[7265], 468.80, accuracy: 0.1, "W333")
        XCTAssertEqual(day1[7630], 0.00, accuracy: 0.1, "X333")
        XCTAssertEqual(day1[7995], 0.00, accuracy: 0.1, "Y333")
        XCTAssertEqual(day1[8360], 1673.42, accuracy: 0.1, "Z333")
        XCTAssertEqual(day1[8725], 3291.09, accuracy: 0.1, "AA333")
        XCTAssertEqual(day1[9090], 497.36, accuracy: 0.1, "AB333")
        XCTAssertEqual(day1[9455], 985.02, accuracy: 0.1, "AC333")
        XCTAssertEqual(day1[9820], 234.40, accuracy: 0.1, "AD333")
        XCTAssertEqual(day1[10185], 468.80, accuracy: 0.1, "AE333")
        XCTAssertEqual(day1[10550], 206.06, accuracy: 0.1, "AF333")
        XCTAssertEqual(day1[10915], 412.12, accuracy: 0.1, "AG333")
        XCTAssertEqual(day1[11280], 28.34, accuracy: 0.1, "AH333")
        XCTAssertEqual(day1[11645], 56.68, accuracy: 0.1, "AI333")
        XCTAssertEqual(day1[12010], -0.56, accuracy: 0.1, "AJ333")
        XCTAssertEqual(day1[12375], 1.00, accuracy: 0.1, "AK333")
        XCTAssertEqual(day1[12740], 1.00, accuracy: 0.1, "AL333")
        XCTAssertEqual(day1[13105], 0.70, accuracy: 0.1, "AM333")
      }
      let day15 = model.day(hour0: hour0, hour2: hour2, hour3: hour3, day11: day1)
      let day16 = model.day(hour0: hour0, hour4: hour4, day11: day1, day15: day15)
      let day17 = model.day(case: j, day1: day1, day5: day15, day6: day16)

      day.append(Array(day17[dayLVstart..<dayMBend]))
      day.append(Array(day17[dayNEstart..<dayNKend]))

      let day21 = model.day(case: j, hour0: hour0)
      if j == 0 {
        XCTAssertEqual(day21[330], 136.32, accuracy: 0.1, "E333")
        XCTAssertEqual(day21[695], 149.51, accuracy: 0.1, "F333")
        XCTAssertEqual(day21[1060], 333.43, accuracy: 0.1, "G333")
        XCTAssertEqual(day21[1425], 543.74, accuracy: 0.1, "H333")
        XCTAssertEqual(day21[1790], 234.40, accuracy: 0.1, "I333")
        XCTAssertEqual(day21[2155], 468.80, accuracy: 0.1, "J333")
        XCTAssertEqual(day21[2520], 0.00, accuracy: 0.1, "K333")
        XCTAssertEqual(day21[2885], 0.00, accuracy: 0.1, "L333")
        XCTAssertEqual(day21[3250], 0.00, accuracy: 0.1, "M333")
        XCTAssertEqual(day21[3615], 0.00, accuracy: 0.1, "N333")
        XCTAssertEqual(day21[3980], 1673.42, accuracy: 0.1, "O333")
        XCTAssertEqual(day21[4345], 3291.09, accuracy: 0.1, "P333")
        XCTAssertEqual(day21[4710], 497.36, accuracy: 0.1, "Q333")
        XCTAssertEqual(day21[5075], 985.02, accuracy: 0.1, "R333")
        XCTAssertEqual(day21[5440], 234.40, accuracy: 0.1, "S333")
        XCTAssertEqual(day21[5805], 468.80, accuracy: 0.1, "T333")
        XCTAssertEqual(day21[6170], 206.06, accuracy: 0.1, "U333")
        XCTAssertEqual(day21[6535], 412.12, accuracy: 0.1, "V333")
        XCTAssertEqual(day21[6900], 28.34, accuracy: 0.1, "W333")
        XCTAssertEqual(day21[7265], 56.68, accuracy: 0.1, "X333")
        XCTAssertEqual(day21[7630], 0.22, accuracy: 0.1, "Y333")
        XCTAssertEqual(day21[7995], -0.56, accuracy: 0.1, "Z333")
        XCTAssertEqual(day21[8360], 1.00, accuracy: 0.1, "AA333")
        XCTAssertEqual(day21[8725], 1.00, accuracy: 0.1, "AB333")
        XCTAssertEqual(day21[9090], 1.00, accuracy: 0.1, "AC333")
        XCTAssertEqual(day21[9455], 1.00, accuracy: 0.1, "AD333")
        XCTAssertEqual(day21[9820], 0.70, accuracy: 0.1, "AE333")
      }
      if j == 1 {
        XCTAssertEqual(day21[330], 150.55, accuracy: 0.1, "AG333")
        XCTAssertEqual(day21[695], 180.55, accuracy: 0.1, "AH333")
        XCTAssertEqual(day21[1060], 189.31, accuracy: 0.1, "AI333")
        XCTAssertEqual(day21[1425], 334.84, accuracy: 0.1, "AJ333")
        XCTAssertEqual(day21[1790], 0.00, accuracy: 0.1, "AK333")
        XCTAssertEqual(day21[2155], 0.00, accuracy: 0.1, "AL333")
        XCTAssertEqual(day21[2520], 206.06, accuracy: 0.1, "AM333")
        XCTAssertEqual(day21[2885], 412.12, accuracy: 0.1, "AN333")
        XCTAssertEqual(day21[3250], 28.34, accuracy: 0.1, "AO333")
        XCTAssertEqual(day21[3615], 56.68, accuracy: 0.1, "AP333")
        XCTAssertEqual(day21[3980], 1656.63, accuracy: 0.1, "AQ333")
        XCTAssertEqual(day21[4345], 3257.50, accuracy: 0.1, "AR333")
        XCTAssertEqual(day21[4710], 562.14, accuracy: 0.1, "AS333")
        XCTAssertEqual(day21[5075], 1114.59, accuracy: 0.1, "AT333")
        XCTAssertEqual(day21[5440], 0.00, accuracy: 0.1, "AU333")
        XCTAssertEqual(day21[5805], 0.00, accuracy: 0.1, "AV333")
        XCTAssertEqual(day21[6170], 206.06, accuracy: 0.1, "AW333")
        XCTAssertEqual(day21[6535], 412.12, accuracy: 0.1, "AX333")
        XCTAssertEqual(day21[6900], 28.34, accuracy: 0.1, "AY333")
        XCTAssertEqual(day21[7265], 56.68, accuracy: 0.1, "AZ333")
        XCTAssertEqual(day21[7630], 1.00, accuracy: 0.1, "BA333")
        XCTAssertEqual(day21[7995], 1.00, accuracy: 0.1, "BB333")
        XCTAssertEqual(day21[8360], 0.96, accuracy: 0.1, "BC333")
        XCTAssertEqual(day21[8725], 0.92, accuracy: 0.1, "BD333")
        XCTAssertEqual(day21[9090], 0.53, accuracy: 0.1, "BE333")
        XCTAssertEqual(day21[9455], 0.06, accuracy: 0.1, "BF333")
        XCTAssertEqual(day21[9820], 1.10, accuracy: 0.1, "BG333")
      }
      if j == 2 {
        XCTAssertEqual(day21[330], 168.15, accuracy: 0.1, "BI333")
        XCTAssertEqual(day21[695], 208.10, accuracy: 0.1, "BJ333")
        XCTAssertEqual(day21[1060], 394.23, accuracy: 0.1, "BK333")
        XCTAssertEqual(day21[1425], 682.49, accuracy: 0.1, "BL333")
        XCTAssertEqual(day21[1790], 0.00, accuracy: 0.1, "BM333")
        XCTAssertEqual(day21[2155], 0.00, accuracy: 0.1, "BN333")
        XCTAssertEqual(day21[2520], 0.00, accuracy: 0.1, "BO333")
        XCTAssertEqual(day21[2885], 0.00, accuracy: 0.1, "BP333")
        XCTAssertEqual(day21[3250], 28.34, accuracy: 0.1, "BQ333")
        XCTAssertEqual(day21[3615], 51.58, accuracy: 0.1, "BR333")
        XCTAssertEqual(day21[3980], 1637.90, accuracy: 0.1, "BS333")
        XCTAssertEqual(day21[4345], 2935.05, accuracy: 0.1, "BT333")
        XCTAssertEqual(day21[4710], 356.09, accuracy: 0.1, "BU333")
        XCTAssertEqual(day21[5075], 640.08, accuracy: 0.1, "BV333")
        XCTAssertEqual(day21[5440], 0.00, accuracy: 0.1, "BW333")
        XCTAssertEqual(day21[5805], 0.00, accuracy: 0.1, "BX333")
        XCTAssertEqual(day21[6170], 0.00, accuracy: 0.1, "BY333")
        XCTAssertEqual(day21[6535], 0.00, accuracy: 0.1, "BZ333")
        XCTAssertEqual(day21[6900], 28.34, accuracy: 0.1, "CA333")
        XCTAssertEqual(day21[7265], 51.58, accuracy: 0.1, "CB333")
        XCTAssertEqual(day21[7630], 1.00, accuracy: 0.1, "CC333")
        XCTAssertEqual(day21[7995], 1.00, accuracy: 0.1, "CD333")
        XCTAssertEqual(day21[8360], 1.00, accuracy: 0.1, "CE333")
        XCTAssertEqual(day21[8725], 1.00, accuracy: 0.1, "CF333")
        XCTAssertEqual(day21[9090], 0.53, accuracy: 0.1, "CG333")
        XCTAssertEqual(day21[9455], 0.14, accuracy: 0.1, "CH333")
        XCTAssertEqual(day21[9820], 1.00, accuracy: 0.1, "CI333")
      }
      if j == 3 {
        XCTAssertEqual(day21[330], 1747.79, accuracy: 0.1, "CK333")
        XCTAssertEqual(day21[695], 3084.89, accuracy: 0.1, "CL333")
        XCTAssertEqual(day21[1060], 738.12, accuracy: 0.1, "CM333")
        XCTAssertEqual(day21[1425], 1310.37, accuracy: 0.1, "CN333")
        XCTAssertEqual(day21[1790], 0.00, accuracy: 0.1, "CO333")
        XCTAssertEqual(day21[2155], 0.00, accuracy: 0.1, "CP333")
        XCTAssertEqual(day21[2520], 0.00, accuracy: 0.1, "CQ333")
        XCTAssertEqual(day21[2885], 0.00, accuracy: 0.1, "CR333")
        XCTAssertEqual(day21[3250], 0.00, accuracy: 0.1, "CS333")
        XCTAssertEqual(day21[3615], 0.00, accuracy: 0.1, "CT333")
        XCTAssertEqual(day21[3980], 55.76, accuracy: 0.1, "CU333")
        XCTAssertEqual(day21[4345], 55.76, accuracy: 0.1, "CV333")
        XCTAssertEqual(day21[4710], 9.70, accuracy: 0.1, "CW333")
        XCTAssertEqual(day21[5075], 9.70, accuracy: 0.1, "CX333")
        XCTAssertEqual(day21[5440], 0.00, accuracy: 0.1, "CY333")
        XCTAssertEqual(day21[5805], 0.00, accuracy: 0.1, "CZ333")
        XCTAssertEqual(day21[6170], 0.00, accuracy: 0.1, "DA333")
        XCTAssertEqual(day21[6535], 0.00, accuracy: 0.1, "DB333")
        XCTAssertEqual(day21[6900], 0.00, accuracy: 0.1, "DC333")
        XCTAssertEqual(day21[7265], 0.00, accuracy: 0.1, "DD333")
        XCTAssertEqual(day21[7630], 1.00, accuracy: 0.1, "DE333")
        XCTAssertEqual(day21[7995], 1.00, accuracy: 0.1, "DF333")
        XCTAssertEqual(day21[8360], 1.00, accuracy: 0.1, "DG333")
        XCTAssertEqual(day21[8725], 1.00, accuracy: 0.1, "DH333")
        XCTAssertEqual(day21[9090], 1.00, accuracy: 0.1, "DI333")
        XCTAssertEqual(day21[9455], 1.00, accuracy: 0.1, "DJ333")
        XCTAssertEqual(day21[9820], 1.00, accuracy: 0.1, "DK333")
      }
      let day27 = model.day(case: j, day1: day21, day6: day6)

      day.append(Array(day27[dayIPstart..<dayIXend]))
      day.append(Array(day27[dayJUstart..<dayKCend]))
    }

    var year = [Int]()
    for d in 0..<365 {
      // let valuesDay = day.indices.map { i in day[i][d] }
      // let best = valuesDay.indices.filter { valuesDay[$0] > 0 }.sorted { valuesDay[$0] > valuesDay[$1] }
      // year.append(best[0])
    }

    let costs = Costs()
  }
}
